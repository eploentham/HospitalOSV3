package com.hospital_os.objdb;import com.hospital_os.usecase.connection.*;import com.hospital_os.utility.*;import com.hospital_os.object.*;import com.hospital_os.*;import java.util.*;import java.sql.*;import com.hospital_os.usecase.connection.Persistent;public class VitalSignDB{    public ConnectionInf theConnectionInf;    public VitalSign dbObj;    final public String idtable = "260";            /**     * @param ConnectionInf db     * @roseuid 3F65897F0326     */    public VitalSignDB(ConnectionInf db)    {        theConnectionInf=db;        dbObj = new VitalSign();        initConfig();    }    public boolean initConfig()    {        dbObj.table="t_visit_vital_sign";        dbObj.pk_field="t_visit_vital_sign_id";        dbObj.visit_id   ="t_visit_id";        dbObj.record_time   ="record_time";        dbObj.record_date   ="record_date";        dbObj.height   ="visit_vital_sign_height";        dbObj.weight   ="visit_vital_sign_weight";        dbObj.pressure   ="visit_vital_sign_blood_presure";        dbObj.temp   ="visit_vital_sign_temperature";        dbObj.puls   ="visit_vital_sign_heart_rate";        dbObj.res   ="visit_vital_sign_respiratory_rate";//        dbObj.general_symptom   ="visit_vital_sign_general_symptom";        dbObj.nutrition   ="f_visit_nutrition_level_id";        dbObj.reporter   ="visit_vital_sign_staff_record";//        dbObj.current_illness   ="visit_vital_sign_current_illness_symptom";        dbObj.patient_id="t_patient_id";        dbObj.bmi="visit_vital_sign_bmi";        dbObj.note = "visit_vital_sign_note";        dbObj.check_date   ="visit_vital_sign_check_date";        dbObj.check_time="visit_vital_sign_check_time";        dbObj.staff_modify="visit_vital_sign_staff_modify";        dbObj.modify_date_time = "visit_vital_sign_modify_date_time";        dbObj.waistline = "visit_vital_sign_waistline";        dbObj.active = "visit_vital_sign_active";        //        dbObj.check_date;//        dbObj.check_time;//        dbObj.staff_modify;//        dbObj.modify_date_time;//        dbObj.active;        return true;    }            /**     * @param cmd     * @param o     * @return int     * @roseuid 3F6574DE0394     */    public int insert(VitalSign o) throws Exception    {        VitalSign p=o;        p.generateOID(idtable);        StringBuffer sql = new StringBuffer("insert into " ).append( dbObj.table ).append( " ("        ).append( dbObj.pk_field        ).append( " ,"	).append( dbObj.visit_id        ).append( " ,"	).append( dbObj.record_time        ).append( " ,"	).append( dbObj.record_date        ).append( " ,"	).append( dbObj.height        ).append( " ,"	).append( dbObj.weight        ).append( " ,"	).append( dbObj.waistline        ).append( " ,"	).append( dbObj.pressure        ).append( " ,"	).append( dbObj.temp        ).append( " ,"	).append( dbObj.puls        ).append( " ,"	).append( dbObj.res        ).append( " ,"	).append( dbObj.nutrition        ).append( " ,"	).append( dbObj.reporter        ).append( " ,"	).append( dbObj.patient_id        ).append( " ,"  ).append( dbObj.bmi        ).append( " ,"  ).append( dbObj.note        ).append( " ,"  ).append( dbObj.check_date        ).append( " ,"  ).append( dbObj.check_time        ).append( " ,"  ).append( dbObj.staff_modify        ).append( " ,"  ).append( dbObj.modify_date_time        ).append( " ,"  ).append( dbObj.active        ).append( " ) values ('"        ).append( p.getObjectId()        ).append( "','" ).append( p.visit_id        ).append( "','" ).append( p.record_time        ).append( "','" ).append( p.record_date        ).append( "','" ).append( p.height        ).append( "','" ).append( p.weight        ).append( "','" ).append( p.waistline        ).append( "','" ).append( p.pressure        ).append( "','" ).append( p.temp        ).append( "','" ).append( p.puls        ).append( "','" ).append( p.res        ).append( "','" ).append( p.nutrition        ).append( "','" ).append( p.reporter        ).append( "','" ).append( p.patient_id        ).append( "','" ).append( p.bmi        ).append( "','" ).append( p.note        ).append( "','"  ).append( p.check_date        ).append( "','"  ).append( p.check_time        ).append( "','"  ).append( p.staff_modify        ).append( "','"  ).append( p.modify_date_time        ).append( "','"  ).append( p.active        ).append( "')");        return theConnectionInf.eUpdate(sql.toString());    }        public int update(VitalSign o) throws Exception    {        VitalSign p=o;        StringBuffer sql = new StringBuffer("update " ).append( dbObj.table ).append( " set "        ).append( dbObj.visit_id ).append( "='" ).append( p.visit_id        ).append( "', " ).append( dbObj.record_time ).append( "='" ).append( p.record_time        ).append( "', " ).append( dbObj.record_date ).append( "='" ).append( p.record_date        ).append( "', " ).append( dbObj.height ).append( "='" ).append( p.height        ).append( "', " ).append( dbObj.weight ).append( "='" ).append( p.weight        ).append( "', " ).append( dbObj.waistline ).append( "='" ).append( p.waistline        ).append( "', " ).append( dbObj.pressure ).append( "='" ).append( p.pressure        ).append( "', " ).append( dbObj.temp ).append( "='" ).append( p.temp        ).append( "', " ).append( dbObj.puls ).append( "='" ).append( p.puls        ).append( "', " ).append( dbObj.res ).append( "='" ).append( p.res        ).append( "', " ).append( dbObj.nutrition ).append( "='" ).append( p.nutrition        ).append( "', " ).append( dbObj.reporter ).append( "='" ).append( p.reporter        ).append( "', " ).append( dbObj.patient_id ).append( "='" ).append( p.patient_id        ).append( "', " ).append( dbObj.bmi ).append( "='" ).append( p.bmi        ).append( "', " ).append( dbObj.note ).append( "='" ).append( p.note        ).append( "', " ).append( dbObj.check_date ).append( "='" ).append( p.check_date        ).append( "', " ).append( dbObj.check_time ).append( "='" ).append( p.check_time        ).append( "', " ).append( dbObj.staff_modify ).append( "='" ).append( p.staff_modify        ).append( "', " ).append( dbObj.modify_date_time ).append( "='" ).append( p.modify_date_time        ).append( "', " ).append( dbObj.active ).append( "='" ).append( p.active        ).append( "' where " ).append( dbObj.pk_field ).append( "='" ).append( p.getObjectId() ).append("'");        return theConnectionInf.eUpdate(sql.toString());    }        public int delete(VitalSign o) throws Exception    {        StringBuffer sql = new StringBuffer("delete from " ).append( dbObj.table        ).append( " where " ).append( dbObj.pk_field ).append( "='" ).append( o.getObjectId() ).append("'");        return theConnectionInf.eUpdate(sql.toString());    }        public Vector selectWeightByVisitID(String visit_id) throws Exception    {        StringBuffer sql = new StringBuffer("select * from " ).append( dbObj.table ).append( "" ).append(        " Where " ).append( dbObj.visit_id ).append( " = '" ).append( visit_id ).append( "'" ).append(        " and " ).append( dbObj.weight ).append( " <>'' " ).append(        " and " ).append( dbObj.active ).append( " = '1'" ).append(        " ORDER BY " ).append( dbObj.record_date ).append( "," ).append( dbObj.record_time ).append( " DESC");        Vector v=eQuery(sql.toString());        if(v.size()==0)            return null;        else            return v;    }        public Vector selectAll() throws Exception    {        StringBuffer sql = new StringBuffer("select * from " ).append( dbObj.table                ).append( " Where " ).append( dbObj.active ).append( " = '1'");        return eQuery(sql.toString());    }/** *@deprecated henbe unused 05/02/07 */        public Vector selectSymptom() throws Exception    {        StringBuffer sql = new StringBuffer( "select  " ).append(//        "," ).append( dbObj.current_illness ).append(        "," ).append(  dbObj.patient_id ).append(        "," ).append( dbObj.reporter ).append(        "," ).append( dbObj.visit_id ).append(        "," ).append( dbObj.record_time ).append(        "," ).append( dbObj.record_date ).append(        " from " ).append( dbObj.table  ).append(        " where " ).append( " " ).append(        " or " ).append( dbObj.current_illness ).append( " <> '' " ) ;        Vector v=eQuerySyptom(sql.toString());        if(v.size()==0)            return null;        else            return v;    }        public VitalSign selectByPK(String pk) throws Exception    {             StringBuffer sql = new StringBuffer("select * from " ).append( dbObj.table         ).append( " where " ).append( dbObj.pk_field         ).append( " = '" ).append( pk ).append( "'"         ).append( " and " ).append( dbObj.active ).append( " = '1'");                  Vector v=eQuery(sql.toString());         if(v.size()==0)             return null;         else             return  (VitalSign)v.get(0);    }        /*     *@author: Amp     *@date: 05/04/2549     */    public int updateActiveById(String id) throws Exception    {        StringBuffer sql = new StringBuffer("update " ).append( dbObj.table ).append( " set "        ).append( dbObj.active ).append( " = '0"        ).append( "' where " ).append( dbObj.pk_field ).append( "='" ).append( id ).append("'");                return theConnectionInf.eUpdate(sql.toString());    }            public Vector selectByVisitId(String pk) throws Exception    {        StringBuffer sql = new StringBuffer("select * from " ).append( dbObj.table        ).append( " where " ).append( dbObj.visit_id        ).append( " = '" ).append( pk ).append( "'"        ).append( " and " ).append( dbObj.active ).append( " = '1'");        return eQuery(sql.toString());    }        public Vector selectByVisitDesc(String pk) throws Exception    {        StringBuffer sql = new StringBuffer("select * from " ).append( dbObj.table        ).append( " where " ).append( dbObj.visit_id ).append( " = '" ).append( pk ).append( "'"        ).append( " and " ).append( dbObj.active ).append( " = '1'"        ).append(" order by " ).append( dbObj.record_date ).append( " || " ).append( dbObj.record_time ).append(" desc ");        return eQuery(sql.toString());    }        public Vector eQuery(String sql) throws Exception    {        VitalSign p;        Vector list = new Vector();        ResultSet rs = theConnectionInf.eQuery(sql.toString());        while(rs.next())        {            p = new VitalSign();            p.setObjectId(rs.getString(dbObj.pk_field));            p.visit_id = rs.getString(dbObj.visit_id);            p.record_time = rs.getString(dbObj.record_time);            p.record_date = rs.getString(dbObj.record_date);            p.height = rs.getString(dbObj.height);            p.weight = rs.getString(dbObj.weight);            p.waistline = rs.getString(dbObj.waistline);            p.pressure = rs.getString(dbObj.pressure);            p.temp = rs.getString(dbObj.temp);            p.puls = rs.getString(dbObj.puls);            p.res = rs.getString(dbObj.res);            p.nutrition = rs.getString(dbObj.nutrition);            p.reporter = rs.getString(dbObj.reporter);            p.patient_id = rs.getString(dbObj.patient_id);            p.bmi = rs.getString(dbObj.bmi);            p.note = rs.getString(dbObj.note);            p.check_date = rs.getString(dbObj.check_date);            p.check_time = rs.getString(dbObj.check_time);            p.staff_modify = rs.getString(dbObj.staff_modify);            p.modify_date_time = rs.getString(dbObj.modify_date_time);            p.active = rs.getString(dbObj.active);            list.add(p);        }        rs.close();        return list;    }/** *@deprecated henbe unused 05/02/07 */        public Vector eQuerySyptom(String sql) throws Exception    {        VitalSign p;        Vector list = new Vector();        ResultSet rs = theConnectionInf.eQuery(sql.toString());        while(rs.next())        {            p = new VitalSign();            p.visit_id = rs.getString(dbObj.visit_id);            p.record_time = rs.getString(dbObj.record_time);            p.record_date = rs.getString(dbObj.record_date);            p.reporter = rs.getString(dbObj.reporter);            p.current_illness = rs.getString(dbObj.current_illness);            p.patient_id = rs.getString(dbObj.patient_id);            p.bmi = rs.getString(dbObj.bmi);            list.add(p);        }        rs.close();        return list;    }        /**@author amp     *list รายการ vital sign ตาม vn     *@deprecated ไม่ให้ใช้ ตั้งชื่อไม่ถูกต้อง     */    public Vector selectByVn(String vn) throws Exception    {        StringBuffer sql = new StringBuffer( "select * from " ).append( dbObj.table        ).append( " where " ).append( dbObj.visit_id ).append( " = '" ).append( vn ).append( "'"        ).append( " and " ).append( dbObj.active ).append( " = '1'"        ).append( " order by " ).append( dbObj.record_date ).append( " desc ,"        ).append( dbObj.record_time ).append( " desc");                Vector v=eQuery(sql.toString());        if(v.size()==0)            return null;        else            return v;    }        /**@author ojika     *list รายการ vital sign ตาม vn     *@deprecated ไม่ให้ใช้ ตั้งชื่อไม่ถูกต้อง     */    public Vector selectByVnOrderByTime(String vn) throws Exception    {        return selectByVidOrderByTime(vn);    }    public Vector selectByVidOrderByTime(String vid) throws Exception    {        StringBuffer sql = new StringBuffer( "select * from " ).append( dbObj.table        ).append( " where " ).append( dbObj.visit_id ).append( " = '" ).append( vid ).append( "'"        ).append( " and " ).append( dbObj.active ).append( " = '1'"        ).append( " order by " ).append( dbObj.record_date ).append( ","        ).append( dbObj.record_time);                Vector v=eQuery(sql.toString());        if(v.size()==0)            return null;        else            return v;    }}