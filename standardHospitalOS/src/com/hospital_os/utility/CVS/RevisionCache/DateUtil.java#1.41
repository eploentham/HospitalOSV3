/* * DateUtil.java * * Created on 26 ?????? 2546, 10:20 ?. */package com.hospital_os.utility;import java.util.*;import java.text.SimpleDateFormat;import com.hospital_os.usecase.connection.*;//import org.apache.log4j.Logger;/** * * @author  tong */public class DateUtil {    public String year;    public String month;    public String date;    public String hour;    public String minute;    public DateUtil() {    }    public static String calPregnant(String date) {        if (date.length() >= 8) {            Date d = getDateFromText(date);            int dd = 0;            int mm = 0;            int yyyy = 0;            Calendar c = Calendar.getInstance();            Calendar c2 = Calendar.getInstance();            c.setTimeInMillis(d.getTime());            dd = c.get(c.DATE) + 280;            mm = c.get(c.MONTH);            yyyy = c.get(c.YEAR);            c.set(yyyy, mm, dd);            String yyyy1 = "0000" + String.valueOf(c.get(c.YEAR));            String mm1 = "00" + String.valueOf(c.get(c.MONTH) + 1);            String dd1 = "00" + String.valueOf(c.get(c.DATE));            yyyy1 = yyyy1.substring(yyyy1.length() - 4, yyyy1.length());            mm1 = mm1.substring(mm1.length() - 2, mm1.length());            dd1 = dd1.substring(dd1.length() - 2, dd1.length());            return dd1 + "/" + mm1 + "/" + yyyy1;        } else {            return "";        }    }    /**     *@Author: amp     *@date: 8/8/2549     *@see: ????????????????????? week ?????????????????     *@param: ????? week     *@return: ??????     */    public static String calDateByWeek(int week) {        String date = new String();        java.util.Date today = new java.util.Date();        java.text.SimpleDateFormat formatter = new java.text.SimpleDateFormat("yyyy-MM-dd");        date = formatter.format(today);        Date d = getDateFromText(date);        int dd = 0;        int mm = 0;        int yyyy = 0;        Calendar c = Calendar.getInstance();        Calendar c2 = Calendar.getInstance();        c.setTimeInMillis(d.getTime());        dd = c.get(c.DATE) + (week * 7);        mm = c.get(c.MONTH);        yyyy = c.get(c.YEAR);        c.set(yyyy, mm, dd);        String yyyy1 = "0000" + String.valueOf(c.get(c.YEAR));        String mm1 = "00" + String.valueOf(c.get(c.MONTH) + 1);        String dd1 = "00" + String.valueOf(c.get(c.DATE));        yyyy1 = yyyy1.substring(yyyy1.length() - 4, yyyy1.length());        mm1 = mm1.substring(mm1.length() - 2, mm1.length());        dd1 = dd1.substring(dd1.length() - 2, dd1.length());        return dd1 + "/" + mm1 + "/" + yyyy1;    }    /**     *@Author: amp     *@date: 8/8/2549     *@see: ????????????????????? week ????????????????     *@param: ??????????,????? week     *@return: ??????     */    public static String calDateByWeek(String date, int week) {        Date d = getDateFromText(date);        int dd = 0;        int mm = 0;        int yyyy = 0;        Calendar c = Calendar.getInstance();        Calendar c2 = Calendar.getInstance();        c.setTimeInMillis(d.getTime());        dd = c.get(c.DATE) + (week * 7);        mm = c.get(c.MONTH);        yyyy = c.get(c.YEAR);        c.set(yyyy, mm, dd);        String yyyy1 = "0000" + String.valueOf(c.get(c.YEAR));        String mm1 = "00" + String.valueOf(c.get(c.MONTH) + 1);        String dd1 = "00" + String.valueOf(c.get(c.DATE));        yyyy1 = yyyy1.substring(yyyy1.length() - 4, yyyy1.length());        mm1 = mm1.substring(mm1.length() - 2, mm1.length());        dd1 = dd1.substring(dd1.length() - 2, dd1.length());        return dd1 + "/" + mm1 + "/" + yyyy1;    }    /**     *@Author amp     *@date 27/04/2549     *@see ???????????????????? ??????????????????????????????     */    public static String countMonth(String date) {        Date d = getDateFromText(date);        Date today = new Date();        if (d == null) {            return "";        }        Calendar c = Calendar.getInstance();        Calendar c2 = Calendar.getInstance();        Calendar c3 = Calendar.getInstance();        c.setTimeInMillis(d.getTime());        c2.setTimeInMillis(System.currentTimeMillis());        c3.setTimeInMillis(today.getTime() - d.getTime());        String year = String.valueOf(c3.get(Calendar.YEAR) - 543 - 1970);        String month = String.valueOf(c3.get(Calendar.MONTH));        if (year.substring(0, 1).equals("-")) {            return "0";        }        int nMonth = 0;        if (month.equals("0")) {            nMonth = Integer.parseInt(year) * 12;            return String.valueOf(nMonth);        } else {            nMonth = (Integer.parseInt(year) * 12) + (Integer.parseInt(month));            return String.valueOf(nMonth);        }    }    /**     *  ?????????? ?????????? ???? ??????     *  ?????? ????????????? ????   yyyy-mm-dd,hh:nn:ss     */    public static Date getDateFromText(String text) {        Calendar c = Calendar.getInstance();        if (text == null || text.length() < 10) {            return null;        }        try {            int yyyy = Integer.parseInt(text.substring(0, 4));            int mm = Integer.parseInt(text.substring(5, 7)) - 1;            int dd = Integer.parseInt(text.substring(8, 10));            c.set(yyyy, mm, dd);//        if(text.length()>10){//            int hh = Integer.parseInt(text.substring(11,13));//            int nn = Integer.parseInt(text.substring(14,16));//            int ss = 0;//            if(text.length()>16)//                ss = Integer.parseInt(text.substring(17));//            c.set(yyyy,mm,dd,hh,nn,ss);//       }            return c.getTime();        } catch (Exception e) {            Constant.println("public static Date getDateFromText(String text)  " + text);            return null;        }    }    /**     *  ?????????? ?????????? ???? ??????     *  ?????? ????????????? ????   yyyy-mm-dd,hh:nn:ss     */    public static Date getDateFromTextServer(String text) {        Calendar c = Calendar.getInstance(Locale.US);        if (text == null || text.length() < 10) {            return null;        }        try {            int yyyy = Integer.parseInt(text.substring(0, 4));            yyyy = yyyy - 543;            int mm = Integer.parseInt(text.substring(5, 7)) - 1;            int dd = Integer.parseInt(text.substring(8, 10));            c.set(yyyy, mm, dd);            if (text.length() > 10) {                int hh = Integer.parseInt(text.substring(11, 13));                int nn = Integer.parseInt(text.substring(14, 16));                int ss = Integer.parseInt(text.substring(17));                c.set(yyyy, mm, dd, hh, nn, ss);            }            return c.getTime();        } catch (Exception e) {            e.printStackTrace(Constant.getPrintStream());            return null;        }    }    /**     * ????????????????? ?????? ?????? dd/mm/yyyy     * ?????? yyyy-mm-dd     */    public static String getGuiBDate(String date) {        if (date == null) {            return "";        }        if (date.length() < 9) {            return "";        }        try {            String temp = new String();            String dd = date.substring(0, date.indexOf("/"));            int ddd = Integer.parseInt(dd);            String d = "00" + String.valueOf(ddd);            d = d.substring(d.length() - 2, d.length());            temp = date.substring(dd.length() + 1);            int m = Integer.parseInt(temp.substring(0, temp.indexOf("/")));            String mm = "00" + String.valueOf(m);            mm = mm.substring(mm.length() - 2, mm.length());            temp = temp.substring(temp.indexOf("/") + 1);            String yyyy = temp.substring(0, 4);            return yyyy + "-" + mm + "-" + d;        } catch (Exception e) {            e.printStackTrace(Constant.getPrintStream());            return null;        }    }    /**     *  ??????????????????? ??????????????? ???????? ???????????????????????     *  ??????? ???????? ???????????????????? ???????? ???? 0      *  ?????????? ???? hh:mm:ss     */    public static boolean checkBeforeTime(String time) {        if (time == null || time.length() <= 4 || time.length() > 8) {            return false;        }        Calendar ctoday = Calendar.getInstance();        Calendar ctime = Calendar.getInstance();        Date today = new Date();        ctoday.setTimeInMillis(today.getTime());        if (time.length() == 5) {            int hh = Integer.parseInt(time.substring(0, 2));            int nn = Integer.parseInt(time.substring(3, 5));            ctime.set(ctoday.get(Calendar.YEAR), ctoday.get(Calendar.MONTH), ctoday.get(Calendar.DATE), hh, nn);        } else {            int hh = Integer.parseInt(time.substring(0, 2));            int nn = Integer.parseInt(time.substring(3, 5));            int ss = Integer.parseInt(time.substring(6));            ctime.set(ctoday.get(Calendar.YEAR), ctoday.get(Calendar.MONTH), ctoday.get(Calendar.DATE), hh, nn, ss);        }        return ctoday.before(ctime);    }    /**     *  ??????????????????? ??????????????? ???????? ???????????????????????     *  ??????? ???????? ??????????????????????? ???????? ???? 0      *  ?????????? ???? hh:mm:ss     */    public static boolean checkAfterTime(String time) {        if (time == null || time.length() <= 4 || time.length() > 8) {            return false;        }        Calendar ctoday = Calendar.getInstance();        Calendar ctime = Calendar.getInstance();        Date today = new Date();        ctoday.setTimeInMillis(today.getTime());        if (time.length() == 5) {            int hh = Integer.parseInt(time.substring(0, 2));            int nn = Integer.parseInt(time.substring(3, 5));            ctime.set(ctoday.get(Calendar.YEAR), ctoday.get(Calendar.MONTH), ctoday.get(Calendar.DATE), hh, nn);        } else {            int hh = Integer.parseInt(time.substring(0, 2));            int nn = Integer.parseInt(time.substring(3, 5));            int ss = Integer.parseInt(time.substring(6));            ctime.set(ctoday.get(Calendar.YEAR), ctoday.get(Calendar.MONTH), ctoday.get(Calendar.DATE), hh, nn, ss);        }        return ctoday.after(ctime);    }    /**     *  ?????????? ?????? ??????? ??? yyyy-mm-dd : MM:ss     *  ???????????? ?????????????(???????) ???????????? ???????????      *  ??? showtime ???? true ??? ????????????     *              ???? false ??? ???????????     */    public static String getDateToString(Date date, boolean showtime) {        String pattern = "dd MMMMM yyyy HH:mm";        String dateString = new String();        java.util.Date today = new java.util.Date();        java.text.SimpleDateFormat formatter = null;        try {            if (showtime) {                formatter = new java.text.SimpleDateFormat(pattern);                if (date != null) {                    dateString = formatter.format(date);                } else {                    dateString = "";                }            } else {                pattern = "dd MMMMM yyyy";                formatter = new java.text.SimpleDateFormat(pattern);                if (date != null) {                    dateString = formatter.format(date);                } else {                    dateString = null;                }            }        } catch (IllegalArgumentException iae) {            dateString = null;        }        formatter = null;        pattern = null;        return dateString;    }    /**     *  ?????????? ?????? ??????? ??? yyyy-mm-dd : MM:ss     *  ???????????? ?????????????(???????) ???????????? ???????????      *  ??? showtime ???? true ??? ????????????     *              ???? false ??? ???????????     */    public static String getDateShotToString(Date date, boolean showtime) {        String pattern = "dd MMM yyyy HH:mm";        String dateString = new String();        java.util.Date today = new java.util.Date();        java.text.SimpleDateFormat formatter = null;        try {            if (showtime) {                formatter = new java.text.SimpleDateFormat(pattern);                dateString = formatter.format(date);            } else {                pattern = "dd MMM yyyy";                formatter = new java.text.SimpleDateFormat(pattern);                dateString = formatter.format(date);            }        } catch (IllegalArgumentException iae) {            dateString = null;        }        formatter = null;        pattern = null;        return dateString;    }    /**     *  ?????????? ?????? ??????? ??? yyyy-mm-dd : MM:ss     *  ???????????? ?????????????(??????) ???????????? ???????????      *  ??? showtime ???? true ??? ????????????     *              ???? false ??? ???????????     */    public static String getDateToStringShort(Date date, boolean showtime) {        String pattern = "dd MMM yy HH:mm";        String dateString = new String();        java.util.Date today = new java.util.Date();        java.text.SimpleDateFormat formatter = null;        try {            if (showtime) {                formatter = new java.text.SimpleDateFormat(pattern);                dateString = formatter.format(date);            } else {                pattern = "dd MMM yy";                formatter = new java.text.SimpleDateFormat(pattern);                dateString = formatter.format(date);            }        } catch (IllegalArgumentException iae) {            dateString = null;        }        formatter = null;        pattern = null;        return dateString;    }    public static String getGuiDateTime(String text) {        if (text == null) {            return "";        }        if (text.length() < 10) {            return "";        }        try {            String yyyy = text.substring(0, 4);            int m = Integer.parseInt(text.substring(5, 7));            String mm = "00" + String.valueOf(m);            mm = mm.substring(mm.length() - 2, mm.length());            String dd = text.substring(8, 10);            if (text.length() >= 16) {                String hh = text.substring(11, 13);                String nn = text.substring(14, 16);                return dd + "/" + mm + "/" + yyyy + "," + hh + ":" + nn;            }            return dd + "/" + mm + "/" + yyyy;        } catch (Exception e) {            e.printStackTrace(Constant.getPrintStream());            return "";        }    }    public static String getTextCurrentDateTime(ConnectionInf c) {        return getTextCurrentDate(c) + "," + getTextCurrentTime(c);    }    public static String getTextCurrentDate(ConnectionInf cc) {        try {            DateTime dt = new DateTime(cc);            String date = dt.getDate();            dt = null;            return date;        } catch (Exception ex) {            Calendar c = Calendar.getInstance();            c.setTimeInMillis(System.currentTimeMillis());            String yyyy = "0000" + String.valueOf(c.get(c.YEAR));            String mm = "00" + String.valueOf(c.get(c.MONTH) + 1);            String dd = "00" + String.valueOf(c.get(c.DATE));            yyyy = yyyy.substring(yyyy.length() - 4, yyyy.length());            mm = mm.substring(mm.length() - 2, mm.length());            dd = dd.substring(dd.length() - 2, dd.length());            return yyyy + "/" + mm + "/" + dd;        }    }    public static String getTextCurrentTime(ConnectionInf cc) {        try {            DateTime dt = new DateTime(cc);            String date = dt.getTime();            dt = null;            return date;        } catch (Exception ex) {            Calendar c = Calendar.getInstance();            c.setTimeInMillis(System.currentTimeMillis());            String hh = "00" + String.valueOf(c.get(c.HOUR_OF_DAY));            String mm = "00" + String.valueOf(c.get(c.MINUTE));            mm = mm.substring(mm.length() - 2, mm.length());            hh = hh.substring(hh.length() - 2, hh.length());            return hh + ":" + mm;        }    }    /**     *  ?????????????????????? ???      *  datestart ???? enddate ???????? true     * @deprecated henbe bad function name     */    public static boolean beforDate(Date startDate, Date endDate) {        return isBeforeDate(startDate, endDate);    }    public static boolean isBeforeDate(Date startDate, Date endDate) {        return startDate.before(endDate);    }    /**     *  ?????????? ???????????????????????     *  ?????????? ???? Object Date     *  ????????? ????      *  1  ??????????     *  2  ?????????     *  3  ?????????     *  4  ??????     *  5  ???????????     *  6  ????????     *  7  ????????                                   */    public static String isDay(Date date) {        String day = new String();        Calendar c = Calendar.getInstance();        c.setTimeInMillis(date.getTime());        /*     numday =c.get(Calendar.DAY_OF_YEAR) -1;        nummonth = c.get(Calendar.MONTH);        numyear =  c.get(Calendar.YEAR) -543 -1970;         */        day = String.valueOf(c.get(Calendar.DAY_OF_WEEK));        c = null;        return day;    }    public static boolean checkTimeLocalThai() {        Date today = new Date();        Calendar c = Calendar.getInstance();        c.setTimeInMillis(today.getTime());        Constant.println(today.toString());        return true;    }    /**     *  ?????????????????????? ???      *  datestart ???? enddate ???????? true     */    public static boolean isToday(Date date) {        int numday = 0;        int nummonth = 0;        int numyear = 0;        Date today = new Date();        Calendar c = Calendar.getInstance();        c.setTimeInMillis(today.getTime() - date.getTime());        numday = c.get(Calendar.DAY_OF_YEAR) - 1;        nummonth = c.get(Calendar.MONTH);        numyear = c.get(Calendar.YEAR) - 543 - 1970;        today = null;        c = null;        if (numday == 0 && nummonth == 0 && numyear == 0) {            return true;        } else {            return false;        }    }    /**     * ????????????? ?? ???????????? ???     * ?????????? ???? String ?????? yyyy-mm-dd,hh:mm:ss     * ????????? ????????? ???????     */    public static int countHourServer(String date) {        int numhour = 0;        if (date != null || date.length() > 0) {            Date d = getDateFromTextServer(date);            Date today = new Date();            Calendar c = Calendar.getInstance(Locale.US);            int numday = 0;            Constant.println("today : " + today.toString());            Constant.println("visit : " + d.toString());            if (today.after(d)) {                c.setTimeInMillis(today.getTime() - d.getTime());                numday = c.get(Calendar.DATE) - 1;                numhour = c.get(Calendar.HOUR) - 7;                Constant.println("Mumber day : " + numday);                Constant.println("Mumber hour : " + numhour);                if (numday > 0) {                    numhour = numhour + numday * 24;                }            } else {                Constant.println("Error date : Data must lest today");                numhour = -1;            }            d = null;            today = null;            c = null;        } else {            numhour = -1;        }        return numhour;    }    /**     * ????????????? ?? ???????????? ???     * ?????????? ???? String ?????? yyyy-mm-dd,hh:mm:ss     * ????????? ????????? ???????     */    public static int countHour(String date, ConnectionInf cc) {        int numhour = 0;        if (date != null || date.length() > 0) {            Date d = getDateFromText(date);            DateTime dt = new DateTime(cc);            Date today;            String dated;            try {                dated = dt.getDate();            } catch (Exception ex) {                dated = null;            }            if (dated != null) {                today = getDateFromText(dated);            } else {                today = new Date();            }            Calendar c = Calendar.getInstance();            int numday = 0;            /*   Constant.println(today.toString());*/            /*   Constant.println(d.toString());*/            if (today.after(d)) {                c.setTimeInMillis(today.getTime() - d.getTime());                numday = c.get(Calendar.DATE) - 1;                numhour = c.get(Calendar.HOUR) - 7;                if (numday > 0) {                    numhour = numhour + numday * 24;                }            } else {                Constant.println("Error date : ?????? ???????????????????????");                numhour = -1;            }            d = null;            today = null;            c = null;        } else {            numhour = -1;        }        return numhour;    }    /**     * ????????????? ?? ???????????? ???     * ?????????? ???? String ?????? yyyy-mm-dd,hh:mm:ss     * ????????? ????????? ???????     */    public static int countMinute(String date, ConnectionInf cc) {        int numhour = 0;        int inumminute = 0;        int iyear = 0;        int im = 0;        if (date != null || date.length() > 0) {            Date d = getDateFromText(date);            DateTime dt = new DateTime(cc);            Date today;            String dated;            try {                dated = dt.getDate();            } catch (Exception ex) {                dated = null;            }            if (dated != null) {                today = getDateFromText(dated);            } else {                today = new Date();            }            Calendar c = Calendar.getInstance();            int numday = 0;            /*   Constant.println(today.toString());*/            /*   Constant.println(d.toString());*/            if (today.after(d)) {                Constant.println("ToDay " + today.toString());                Constant.println("Day " + d.toString());                Constant.println(today.toString());                c.setTimeInMillis(today.getTime() - d.getTime());                iyear = c.get(Calendar.YEAR) - 2513;                im = c.get(Calendar.MONTH);                numday = c.get(Calendar.DATE) - 1;                numhour = c.get(Calendar.HOUR) - 7;                inumminute = c.get(Calendar.MINUTE);                Constant.println(iyear);                Constant.println(im);                Constant.println(numday);                Constant.println(numhour);                Constant.println(inumminute);                //  if(numday >0)                inumminute = iyear * 365 * 30 * 24 * 60 + im * 30 * 24 * 60 + numhour * 60 + numday * 24 * 60 + inumminute;            } else {                Constant.println("Error date : ?????? ???????????????????????");                inumminute = -1;            }            d = null;            today = null;            c = null;        } else {            inumminute = -1;        }        return inumminute;    }    /**     * ????????????? ?? ???????????? ???     * ?????????? ???? String ?????? yyyy-mm-dd,hh:mm:ss     * ????????? ????????? ???????     *@deprecated henbe unused     */    public static int countWeek(String date) {        Date d = getDateFromText(date);        Date today = new Date();        return countWeek(d, today);    }    public static int countWeek(String date, String date_ref) {        Calendar d = getCalendarFromText(date);        Calendar today = getCalendarFromText(date_ref);        if (d != null && today != null) {            return today.get(today.WEEK_OF_YEAR) - d.get(d.WEEK_OF_YEAR);        }        return 0;    }        public static String countWeekS(String date, String date_ref) {        int[] week_day = countWeekDay(date, date_ref);        if (week_day == null) {            return "การคำนวนผิดพลาด";        }//            Constant.println(day);        if (week_day[1] == 0) {            return week_day[0] + " สัปดาห์";        }        if (week_day[0] == 0) {            return week_day[1] + " วัน";        }        return week_day[0] + " สัปดาห์ " + week_day[1] + " วัน";    }    /**     *      * ทดสอบการคำนวนวันจะต้องเทียบต่างปีได้ดังนี้     * @param date     * @param date_ref     * @return     */    public static int[] countWeekDay(String date, String date_ref) {//        System.out.println("date = " + date);//        System.out.println("date_ref = " + date_ref);        if(date == null || date.equals("")){            date = date_ref;        }else if(date.length() < 10){            date += ",00:00";        }        String lastMen = calPregnant(date);        lastMen = getGuiBDate(lastMen);        if(lastMen.length() < 10){            lastMen += ",00:00";        }        if(date.length() < 10 || lastMen.length() < 10){            return new int[]{0,0};        }//        System.out.println("lastMen = " + lastMen);//        System.out.println("(getDateFromText(lastMen).getTime() = " + (getDateFromText(lastMen).getTime()));//        System.out.println("(getDateFromText(date_ref).getTime() = " + (getDateFromText(date_ref).getTime()));        int fetalage = (int) (14 + 266 - ((getDateFromText(lastMen).getTime() - getDateFromText(date_ref).getTime()) / 86400000));        int weeks = fetalage / 7;        int days = (int) Math.floor(fetalage % 7);        return new int[]{weeks, days};//        Constant.println("public static int[] countWeekDay(String date, String date_ref) ");//        Calendar d = getCalendarFromText(date);//        Calendar today = getCalendarFromText(date_ref);//        if(d == null)//            return null;//        if(today == null)//            return null;////        int year = today.get(Calendar.YEAR) - d.get(Calendar.YEAR);//        int week = today.get(Calendar.WEEK_OF_YEAR) - d.get(Calendar.WEEK_OF_YEAR);//        int day = today.get(Calendar.DAY_OF_WEEK) - d.get(Calendar.DAY_OF_WEEK);//        Constant.println(year);//        Constant.println(week);//        Constant.println(day);//        if (year < 0) {//            return null;//        }//        if (year == 0 && week < 0) {//            return null;//        }//        if (year == 0 && week == 0 && day < 0) {//            return null;//        }////        int total_week = year * 52;//        total_week += week;//        if (day < 0) {//            day = day + 7;//            total_week--;//        }//        return new int[]{total_week, day};    }        /**     *  แปลงข้อมูล จากข้อความ เป็น วันที่     *  รูปแบบ ของข้อมูลเข้า เป็น   yyyy-mm-dd,hh:nn:ss     */    public static Calendar getCalendarFromText(String text) {        Calendar c = Calendar.getInstance();        if (text == null || text.length() < 10) {            return null;        }        try {            int yyyy = Integer.parseInt(text.substring(0, 4));            int mm = Integer.parseInt(text.substring(5, 7)) - 1;            int dd = Integer.parseInt(text.substring(8, 10));            c.set(yyyy, mm, dd);            if (text.length() > 10) {                int hh = Integer.parseInt(text.substring(11, 13));                int nn = Integer.parseInt(text.substring(14, 16));                int ss = 0;                if (text.length() > 17) {                    ss = Integer.parseInt(text.substring(17));                }                c.set(yyyy, mm, dd, hh, nn, ss);            }            return c;        } catch (Exception e) {            e.printStackTrace();            return null;        }    }    public static int countWeek(Date d, Date today) {        int numweek = 0;        Calendar c = Calendar.getInstance();        if (d != null && today != null) {            if (today.after(d)) {                c.setTimeInMillis(today.getTime() - d.getTime());                numweek = c.get(c.WEEK_OF_YEAR) - 1;            } else {                c.setTimeInMillis(d.getTime() - today.getTime());                numweek = c.get(c.WEEK_OF_YEAR) - 1;            }        } else {            numweek = -1;        }        return numweek;    }    /**     * ????????????? ?? ???????? ???     * ?????????? ???? String ?????? yyyy-mm-dd,hh:mm:ss ???? yyyy-mm-dd     * ????????? ????????? ???????     */    public static int countDay(String date) {        int numday = 0;        if (date != null || date.length() > 0) {            Date d = getDateFromText(date);            Date today = new Date();            Calendar c = Calendar.getInstance();            if (today.after(d)) {                c.setTimeInMillis(today.getTime() - d.getTime());                numday = c.get(Calendar.DATE) - 1;            } else {                Constant.println("Error date : ?????? ???????????????????????");                numday = -1;            }            d = null;            today = null;            c = null;        } else {            numday = -1;        }        return numday;    }    /**     * ????????????? ?? ???????? ???     * ?????????? ???? String ?????? yyyy-mm-dd,hh:mm:ss ???? yyyy-mm-dd ????? 2 ???     * ??? ?????????????? ???????????????????     * ????????? ????????????     */    public static int countDayByTwoDate(String begin_date, String end_date) {        int numday = 0;        if (begin_date != null || begin_date.length() > 0) {            Date begin = getDateFromText(begin_date);            Date end = getDateFromText(end_date);            Calendar c = Calendar.getInstance();            if (end.after(begin)) {                c.setTimeInMillis(end.getTime() - begin.getTime());                numday = c.get(Calendar.DATE) - 1;            } else {                Constant.println("Error date : ?????? Admit ?????????????????? Discharge");                numday = -1;            }            begin = null;            end = null;            c = null;        } else {            numday = -1;        }        return numday;    }    public static long initDay(String startDate, String endDate) throws Exception {        SimpleDateFormat sdFormat = new SimpleDateFormat("yyyy-MM-dd,HH:mm:ss", new Locale("en", "US"));        Calendar calStart = Calendar.getInstance();        Calendar calEnd = Calendar.getInstance();        calStart.setTime(sdFormat.parse(startDate));        calEnd.setTime(sdFormat.parse(endDate));        long a = calEnd.getTimeInMillis() - calStart.getTimeInMillis();        return (a / (86400000L));    }    public static long initHour(String startDate, String endDate) throws Exception {        SimpleDateFormat sdFormat = new SimpleDateFormat("yyyy-MM-dd,HH:mm:ss", new Locale("en", "US"));        Calendar calStart = Calendar.getInstance();        Calendar calEnd = Calendar.getInstance();        calStart.setTime(sdFormat.parse(startDate));        calEnd.setTime(sdFormat.parse(endDate));        long a = calEnd.getTimeInMillis() - calStart.getTimeInMillis();        return ((a % (86400000L)) / 3600000L);    }    public static String addDay(String date, int qty) {        long curr_day = getDateFromText(date).getTime();        curr_day = curr_day + 1000 * 60 * 60 * 24 * Long.parseLong(String.valueOf(qty));        Date d = new Date(curr_day);        String new_day = getTextDB(d, false);//        Constant.println(new_day);        return new_day;    }    public static String minusDay(String date, int qty) {        long curr_day = getDateFromText(date).getTime();        curr_day = curr_day - 1000 * 60 * 60 * 24 * qty;        Date d = new Date(curr_day);        String new_day = getTextDB(d, false);        Constant.println(new_day);        return new_day;    }    public static String getTextDB(Date date, boolean showtime) {        String pattern = "yyyy-MM-dd,HH:mm:ss";        String dateString = new String();        java.text.SimpleDateFormat formatter = null;        try {            if (showtime) {                formatter = new java.text.SimpleDateFormat(pattern);                if (date != null) {                    dateString = formatter.format(date);                } else {                    dateString = "";                }            } else {                pattern = "yyyy-MM-dd";                formatter = new java.text.SimpleDateFormat(pattern);                // Constant.println(date);                if (date != null) {                    dateString = formatter.format(date);                } else {                    dateString = null;                }            }        } catch (IllegalArgumentException iae) {            dateString = null;        }        formatter = null;        pattern = null;        return dateString;    }    /**     *@deprecated henbe unused please use      *public static String calculateAge(String date,String datetime)     */    public static String calculateAge(String date) {        Date d = getDateFromText(date);        if (d == null) {            return "";        }        Calendar c = Calendar.getInstance();        Calendar c2 = Calendar.getInstance();        c.setTimeInMillis(d.getTime());        c2.setTimeInMillis(System.currentTimeMillis());        return calculateAge(c, c2, false);    }    public static String calculateAge(String date, String datetime) {        Date d = getDateFromText(date);        if (d == null) {            return "";        }        Calendar c = Calendar.getInstance();        Calendar c2 = Calendar.getInstance();        c.setTimeInMillis(d.getTime());        Date dt = DateUtil.getDateFromText(datetime);        if (dt == null) {            return "";        }        c2.setTimeInMillis(dt.getTime());        return calculateAge(c, c2, false);    }    public static int calculateAgeMonth(String date, String datetime) {        Date d = getDateFromText(date);        if (d == null) {            return -1;        }        Calendar c = Calendar.getInstance();        Calendar c2 = Calendar.getInstance();        c.setTimeInMillis(d.getTime());        Date dt = DateUtil.getDateFromText(datetime);        if (dt == null) {            return -1;        }        c2.setTimeInMillis(dt.getTime());        return calculateAgeMonth(c, c2, false, ("ปี"), ("เดือน"), ("วัน"));    }    /**     * @author henbe     * ????????????????????????????????????????????????????????????????? ?? ????? ???     * ????????????????     * static String calculateAgeLong(String date_in,String cur_date)     */    public static String calculateAge(Calendar d, Calendar today, boolean long_mode) {        return calculateAge(d, today, long_mode, ("ปี"), ("เดือน"), ("วัน"));    }    private static int calculateAgeMonth(Calendar d, Calendar today, boolean long_mode, String syear, String smonth, String sday) {        int year = today.get(Calendar.YEAR) - d.get(Calendar.YEAR);        int month = today.get(Calendar.MONTH) - d.get(Calendar.MONTH);        if (month < 0) {            month = today.get(Calendar.MONTH) - d.get(Calendar.MONTH) + 12;            year = year - 1;        }        if (year > 0) {            month += year * 12;        }        return month;    }    public static void main(String[] argv)    {         Constant.println(calculateAge("2523-09-15","2551-09-15",true,"y","m","d"));        Constant.println(calculateAge("2550-12-15","2551-01-15",true,"y","m","d"));        Constant.println(calculateAge("2553-02-19","2553-03-02",true,"y","m","d"));    }    public static String calculateAge(String date_in, String cur_date, boolean long_mode, String syear, String smonth, String sday)    {        Calendar d = Calendar.getInstance();        d.setTime(getDateFromText(date_in));        Calendar today = Calendar.getInstance();        today.setTime(DateUtil.getDateFromText(cur_date));        return calculateAge(d,today,long_mode,syear,smonth,sday);    }    public static String calculateAge(Calendar d, Calendar today, boolean long_mode, String syear, String smonth, String sday)    {        int year = today.get(Calendar.YEAR) - d.get(Calendar.YEAR);        if (long_mode) {            int month = today.get(Calendar.MONTH) - d.get(Calendar.MONTH);            if (month < 0) {                month = today.get(Calendar.MONTH) - d.get(Calendar.MONTH) + 12;                year = year - 1;            }            int date = today.get(Calendar.DAY_OF_MONTH) - d.get(Calendar.DAY_OF_MONTH);            if (date < 0) {                date = d.getActualMaximum(Calendar.DAY_OF_MONTH) - d.get(Calendar.DAY_OF_MONTH) + today.get(Calendar.DAY_OF_MONTH);                if (month > 0) {                    month = month - 1;                } else {                    year = year - 1;                    month = 11;                }            }            ////////////////////////////////////////////////////////////            String ret_str = new String();            if (year != 0)                 ret_str = year + " " + syear;            if (month != 0)                 ret_str = ret_str + " " + month + " " + smonth;            //กรณีเด็กเพิ่งเกิดจะได้แสดงอายุด้วย            if (date != 0 || (year == 0 && month == 0))                 ret_str = ret_str + " " + date + " " + sday;            return ret_str;        }        else {            String year_s = String.valueOf(year);            if (!year_s.equals("")) {                if (year_s.substring(0, 1).equals("-"))                     return "0";                else                     return year_s;// +" ?? "+ month +" ????? "+ date +" ??? ";            } else                 return "0";        }    }    /**     * ????????????? ?? ???????? ???     * ?????????? ???? String ?????? yyyy-mm-dd,hh:mm:ss ???? yyyy-mm-dd     * ????????? ????????? ?????????????? ?????????????     */    public static int countDateDiff(String day_check, String day_ref) {        int numday = 0;        if (day_check.length() >= 10) {            day_check = day_check.substring(0, 10);        }        if (day_ref.length() >= 10) {            day_ref = day_ref.substring(0, 10);        }        Date d = getDateFromText(day_check);        Date today = getDateFromText(day_ref);        if (d == null || d == null) {            return 0;        }        long diff = d.getTime() - today.getTime();        //day = 24 hour        //hour = 60 minute        //minute = 60 second        //second = 1000 ;    24*60*60*1000        long day_long = 24 * 60 * 60 * 1000;//        Constant.println("public static int countDateDiff(String day_check,String day_ref)" + diff/day_long);        numday = Integer.parseInt(Long.toString(diff / day_long));        return numday;    }    //GUtil.convertFieldDate    public static String convertFieldDate(String text) {        return getGuiDateTime(text);    }     public static boolean isBeforeDate(String date, String date_ref) {        Date d_main = getDateFromText(date);        Date d_ref = getDateFromText(date_ref);        if (d_main != null && d_ref != null) {            return d_main.before(d_ref);        }        return false;    }    public static boolean isAfterDate(String date, String date_ref) {        Date d_main = getDateFromText(date);        Date d_ref = getDateFromText(date_ref);        if (d_main != null && d_ref != null) {            return d_main.after(d_ref);        }        return false;    }}