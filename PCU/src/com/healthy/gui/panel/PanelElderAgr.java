
/*
 * PanelElderAgr.java
 *
 * Created on 7 เมษายน 2549, 9:27 น.
 */

package com.healthy.gui.panel;

import com.hosv3.utility.DateUtil;
import com.pcu.control.HtControl;
import com.hosv3.utility.connection.UpdateStatus;
import com.pcu.utility.GutilPCU;
import java.util.*;
import javax.swing.*;
import com.healthy.object.*;
import com.hospital_os.utility.*;
import com.hospital_os.object.*;
import com.pcu.object.*;
import java.awt.*;
/**
 *
 * @author  hospitalos5
 */
public class PanelElderAgr extends javax.swing.JPanel  {
    
    public Vector theElderAgrV;
    HtControl theHtControl;
    Vector agrListV;
    ElderAgr theElderAgr;
    Family theFamily;
    JDialog jDialog;

    private UpdateStatus theUS;
    /** Creates new form PanelElderAgr */
    public PanelElderAgr() {
        initComponents();
        theElderAgr = new ElderAgr();
        setDisable();
        setLanguage();
    }
    
    public void setControl(HtControl ht,UpdateStatus us){
         theUS = us;
        theHtControl = ht;
        ComboboxModel.initComboBox(this.jComboBoxClub, theHtControl.listAgr());
        //initComboBoxElderAgr(this.jComboBoxClub, theHtControl.listAgr());
        
        this.dateComboDateServ.setEditable(true);
        this.jTextFieldYearBudget.setText(theHtControl.getYear());
        buttonDeleteEnable();
        setLanguage();
    }
    //**************************** เพิ่มเอง
    public static boolean initComboBoxElderAgr(JComboBox jc,Vector xfix)
    {
        if(xfix==null || jc==null) return false;
        if(jc!=null && jc.getItemCount()>0)
            jc.removeAllItems();
        for(int i=0;i<xfix.size();i++)
        {
            AGR agr = (AGR)xfix.get(i);
            jc.addItem(agr.agr_name);
        }
        return true;
    } 
    //*****************************
    public void updateOGElderAgr(Vector v) {
        theElderAgrV = v;
        if (v==null) v = new Vector();
        String[] column = {"วันที่ปรับปรุงล่าสุด"};
        GutilPCU.setLanguage(column);
        TaBleModel tm = new TaBleModel(column, v.size());
        
        for (int i=0 ; i<v.size() ; i++) {
            ElderAgr elderAgr = (ElderAgr)v.get(i);
            tm.setValueAt(GutilPCU.changDateToString(elderAgr.record_time), i, 0);            
        }
        this.jTable4.setModel(tm);
    }
    
    public void updateOGElderAgr(ElderAgr elderAgr){
        //ใส่ค่าในปีงบประมาณ
        this.jTextFieldYearBudget.setText(elderAgr.idy);
        //ใส่ค่าในวันที่สำรวจ
        this.dateComboDateServ.setText(DateUtil.convertFieldDate(elderAgr.date_serv));
        //ใส่ค่าใน checkbox การเข้าร่วมชมรม
        if (elderAgr.isJoin.equals(Active.isEnable())) 
        {
            this.jCheckBox2.setSelected(true);
            this.jComboBoxClub.setEnabled(true);
            ComboboxModel.setCodeComboBox(this.jComboBoxClub, elderAgr.agr_id);
        }
        else
        {
            this.jCheckBox2.setSelected(false);
            this.jComboBoxClub.setEnabled(false);
            this.jComboBoxClub.setSelectedIndex(-1);
        }
        this.jTextFieldYearBudget.setText(theHtControl.getYear());
    }
    
   public void updateGOElderAgr(ElderAgr elderAgr){
        elderAgr.family_id = theFamily.getObjectId();
        //ปีงบประมาณ
        elderAgr.idy = this.jTextFieldYearBudget.getText();
        //วันที่สำรวจ
        elderAgr.date_serv = this.dateComboDateServ.getText();
        //ใส่ค่าใน combobox เลือกชมรม
        if (jCheckBox2.isSelected()) {
            elderAgr.isJoin = Active.isEnable();
            elderAgr.agr_id = Gutil.getGuiData(this.jComboBoxClub);
        } else {
            elderAgr.isJoin = Active.isDisable();
            elderAgr.agr_id = "";
        }
    } 
   public void updateFamily(Family family) {
        theFamily = family;
        Vector familyV = theHtControl.listElderAgrByFid(family.getObjectId());
        updateOGElderAgr(familyV);
        updateOGElderAgr(new ElderAgr());
   }
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jPanelElderAgr = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        jScrollPane4 = new javax.swing.JScrollPane();
        jTable4 = new javax.swing.JTable();
        jPanel2 = new javax.swing.JPanel();
        jLabel35 = new javax.swing.JLabel();
        jTextFieldYearBudget = new javax.swing.JTextField();
        jLabel36 = new javax.swing.JLabel();
        jLabel37 = new javax.swing.JLabel();
        jPanel9 = new javax.swing.JPanel();
        jCheckBox2 = new javax.swing.JCheckBox();
        jComboBoxClub = new javax.swing.JComboBox();
        dateComboDateServ = new com.hospital_os.utility.DateComboBox();
        jPanel8 = new javax.swing.JPanel();
        jButtonAdd = new javax.swing.JButton();
        jButtonDelete = new javax.swing.JButton();
        jButtonSave = new javax.swing.JButton();

        setLayout(new java.awt.BorderLayout());

        jPanelElderAgr.setLayout(new java.awt.GridBagLayout());

        jPanel1.setLayout(new java.awt.GridBagLayout());

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder("\u0e1b\u0e23\u0e30\u0e27\u0e31\u0e15\u0e34\u0e01\u0e32\u0e23\u0e04\u0e31\u0e14\u0e01\u0e23\u0e2d\u0e07"));
        jPanel1.setMinimumSize(new java.awt.Dimension(180, 90));
        jPanel1.setPreferredSize(new java.awt.Dimension(180, 90));
        jScrollPane4.setMinimumSize(new java.awt.Dimension(24, 150));
        jScrollPane4.setPreferredSize(new java.awt.Dimension(4, 150));
        jTable4.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null}
            },
            new String [] {
                "Title 1"
            }
        ));
        jTable4.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseReleased(java.awt.event.MouseEvent evt) {
                jTable4MouseReleased(evt);
            }
        });

        jScrollPane4.setViewportView(jTable4);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel1.add(jScrollPane4, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridheight = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.VERTICAL;
        gridBagConstraints.weighty = 1.0;
        jPanelElderAgr.add(jPanel1, gridBagConstraints);

        jPanel2.setLayout(new java.awt.GridBagLayout());

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder("\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e01\u0e32\u0e23\u0e40\u0e02\u0e49\u0e32\u0e23\u0e48\u0e27\u0e21\u0e0a\u0e21\u0e23\u0e21\u0e02\u0e2d\u0e07\u0e1c\u0e39\u0e49\u0e2a\u0e39\u0e07\u0e2d\u0e32\u0e22\u0e38"));
        jLabel35.setText("\u0e1b\u0e35\u0e07\u0e1a\u0e1b\u0e23\u0e30\u0e21\u0e32\u0e13 : ");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 2, 0, 0);
        jPanel2.add(jLabel35, gridBagConstraints);

        jTextFieldYearBudget.setMinimumSize(new java.awt.Dimension(60, 24));
        jTextFieldYearBudget.setPreferredSize(new java.awt.Dimension(60, 21));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.insets = new java.awt.Insets(2, 0, 0, 0);
        jPanel2.add(jTextFieldYearBudget, gridBagConstraints);

        jLabel36.setText("\u0e27\u0e31\u0e19\u0e17\u0e35\u0e48\u0e2a\u0e33\u0e23\u0e27\u0e08 : ");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.insets = new java.awt.Insets(2, 20, 0, 0);
        jPanel2.add(jLabel36, gridBagConstraints);

        jLabel37.setText("\u0e01\u0e32\u0e23\u0e40\u0e02\u0e49\u0e32\u0e23\u0e48\u0e27\u0e21\u0e0a\u0e21\u0e23\u0e21 : ");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 2, 2, 0);
        jPanel2.add(jLabel37, gridBagConstraints);

        jPanel9.setLayout(new java.awt.GridBagLayout());

        jCheckBox2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBox2ActionPerformed(evt);
            }
        });

        jPanel9.add(jCheckBox2, new java.awt.GridBagConstraints());

        jComboBoxClub.setMinimumSize(new java.awt.Dimension(100, 24));
        jComboBoxClub.setPreferredSize(new java.awt.Dimension(100, 24));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        jPanel9.add(jComboBoxClub, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(2, 0, 2, 2);
        jPanel2.add(jPanel9, gridBagConstraints);

        dateComboDateServ.setMinimumSize(new java.awt.Dimension(100, 24));
        dateComboDateServ.setPreferredSize(new java.awt.Dimension(100, 24));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanel2.add(dateComboDateServ, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 0);
        jPanelElderAgr.add(jPanel2, gridBagConstraints);

        jPanel8.setLayout(new java.awt.GridBagLayout());

        jButtonAdd.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/hosv3/gui/images/plus16.gif")));
        jButtonAdd.setMargin(new java.awt.Insets(0, 0, 0, 0));
        jButtonAdd.setMaximumSize(new java.awt.Dimension(24, 24));
        jButtonAdd.setMinimumSize(new java.awt.Dimension(24, 24));
        jButtonAdd.setPreferredSize(new java.awt.Dimension(24, 24));
        jButtonAdd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonAddActionPerformed(evt);
            }
        });

        jPanel8.add(jButtonAdd, new java.awt.GridBagConstraints());

        jButtonDelete.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/hosv3/gui/images/minus16.gif")));
        jButtonDelete.setMargin(new java.awt.Insets(0, 0, 0, 0));
        jButtonDelete.setMaximumSize(new java.awt.Dimension(24, 24));
        jButtonDelete.setMinimumSize(new java.awt.Dimension(24, 24));
        jButtonDelete.setPreferredSize(new java.awt.Dimension(24, 24));
        jButtonDelete.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonDeleteActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 3, 0, 0);
        jPanel8.add(jButtonDelete, gridBagConstraints);

        jButtonSave.setText("\u0e1a\u0e31\u0e19\u0e17\u0e36\u0e01");
        jButtonSave.setMaximumSize(new java.awt.Dimension(63, 24));
        jButtonSave.setMinimumSize(new java.awt.Dimension(73, 24));
        jButtonSave.setPreferredSize(new java.awt.Dimension(73, 24));
        jButtonSave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonSaveActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        gridBagConstraints.weightx = 1.0;
        jPanel8.add(jButtonSave, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 0);
        jPanelElderAgr.add(jPanel8, gridBagConstraints);

        add(jPanelElderAgr, java.awt.BorderLayout.CENTER);

    }// </editor-fold>//GEN-END:initComponents

    private void jTable4MouseReleased(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTable4MouseReleased
        this.setCursor(new java.awt.Cursor(java.awt.Cursor.WAIT_CURSOR));            
        int index = this.jTable4.getSelectedRow();
        if(index==-1)
            return;
        theElderAgr = (ElderAgr)theElderAgrV.get(index);
        updateOGElderAgr(theElderAgr);
        /*this.jTextFieldStatus.setText(theImageLink.image_path);
        this.jTextFieldHN1.setText(theImageLink.note);
        this.jCheckBox1.setSelected(theImageLink.note.equals(
            ImageLink.ST_PatientImage));
        this.jTextFieldHN1.setEditable(!this.jCheckBox1.isSelected());*/
        this.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR)); 
        buttonDeleteEnable();
        setEnable();
    }//GEN-LAST:event_jTable4MouseReleased

    private void jButtonSaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonSaveActionPerformed
        this.updateGOElderAgr(theElderAgr);
        this.theHtControl.saveElderAgr(theElderAgr);
        this.updateFamily(theFamily);
        buttonDeleteEnable();
    }//GEN-LAST:event_jButtonSaveActionPerformed

    private void jButtonAddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonAddActionPerformed
        theElderAgr = new ElderAgr();
        this.updateOGElderAgr(theElderAgr);
        setEnable();
    }//GEN-LAST:event_jButtonAddActionPerformed

    private void jButtonDeleteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonDeleteActionPerformed
        if (theUS.confirmBox("คุณต้องการลบข้อมูลที่เลือกหรือไม่",UpdateStatus.WARNING))
        {
            this.theHtControl.deleteElderAgr(theElderAgr);
            this.updateFamily(theFamily);
            theElderAgr = new ElderAgr();
            updateOGElderAgr(theElderAgr);
            buttonDeleteEnable();
            setDisable();           
        }
    }//GEN-LAST:event_jButtonDeleteActionPerformed

    private void jCheckBox2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBox2ActionPerformed
        this.jComboBoxClub.setEnabled(this.jCheckBox2.isSelected());
    }//GEN-LAST:event_jCheckBox2ActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private com.hospital_os.utility.DateComboBox dateComboDateServ;
    private javax.swing.JButton jButtonAdd;
    private javax.swing.JButton jButtonDelete;
    private javax.swing.JButton jButtonSave;
    private javax.swing.JCheckBox jCheckBox2;
    private javax.swing.JComboBox jComboBoxClub;
    private javax.swing.JLabel jLabel35;
    private javax.swing.JLabel jLabel36;
    private javax.swing.JLabel jLabel37;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JPanel jPanelElderAgr;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JTable jTable4;
    private javax.swing.JTextField jTextFieldYearBudget;
    // End of variables declaration//GEN-END:variables
    public void showDialog(Family family) {
        if(jDialog==null)
        {
            if(theHtControl.theUS!=null)
                jDialog = new JDialog(this.theHtControl.theUS.getJFrame(),true);
            else
                jDialog = new JDialog();
            jDialog.getContentPane().add(this);
            jDialog.setDefaultCloseOperation(JDialog.DISPOSE_ON_CLOSE);
            jDialog.setSize(650, 145);
            Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
            jDialog.setLocation((screenSize.width-jDialog.getSize().width)/2
                    , (screenSize.height-jDialog.getSize().height)/2);
        }
        updateFamily(family);
        setDisable();
        jDialog.setVisible(true);
    }
    
//    public static void showDialog(Family family, ConnectionInf con) {
//        JDialog jDialog = new JDialog();
//        PanelElderAgr panel = new PanelElderAgr();
//        jDialog.getContentPane().add(panel);
//        HtControl hc = new HtControl(con);
//        panel.setControl(hc);
//        panel.updateFamily(family);
//        jDialog.setSize(650, 145);
//        jDialog.setVisible(true);
//    }
    
    public static void main(String[] argc)
    {
        System.setProperty("debug", "1");
        Family family = new Family();
        family.hospital_site = "00000";
        family.setObjectId("555");
        HtControl hc = new HtControl();
        PanelElderAgr thePanelElderAgr = new PanelElderAgr();
        thePanelElderAgr.setControl(hc,hc.theUS);  
        thePanelElderAgr.showDialog(family);
    }
    
    
    private void buttonDeleteEnable() {
        if (theElderAgr.getObjectId()!=null) 
            this.jButtonDelete.setEnabled(true);
        else
            this.jButtonDelete.setEnabled(false);
    }
    
    private void setEnable() {
        this.jTextFieldYearBudget.setEnabled(true);
        this.dateComboDateServ.setEnabled(true);
        this.jCheckBox2.setEnabled(true);
        this.jButtonSave.setEnabled(true);
        
    }
    
    private void setDisable() {
        this.jTextFieldYearBudget.setEnabled(false);
        this.dateComboDateServ.setEnabled(false);
        this.jCheckBox2.setEnabled(false);
        this.jComboBoxClub.setEnabled(false);
        this.jButtonSave.setEnabled(false);
        jComboBoxClub.setEnabled(false);
    }

    private void setLanguage() {
        GutilPCU.setLanguage(jPanel1);
        GutilPCU.setLanguage(jPanel2);
        GutilPCU.setLanguage(jLabel35);
        GutilPCU.setLanguage(jLabel36);
        GutilPCU.setLanguage(jLabel37);
        GutilPCU.setLanguage(jButtonSave);
    }
}
