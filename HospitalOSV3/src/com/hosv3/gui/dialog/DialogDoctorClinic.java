/*
 * DialogOffDrug.java
 *
 * Created on 13 พฤษภาคม 2547, 18:10 น.
 */

package com.hosv3.gui.dialog;
import com.hosv3.object.HosObject;
import com.hosv3.utility.Constant;
import java.awt.*;
import java.util.*;

import com.hosv3.control.*;
import com.hosv3.utility.*;
import com.hosv3.utility.connection.*;

import com.hospital_os.object.*; 
import com.hospital_os.utility.Gutil;
import com.hospital_os.utility.ComboboxModel;

/**
 * 
 * @author amp
 * ยกเลิก@deprecated ผิด pattern ต้องแก้ให้ dialog รับและแสดง
 * ข้อมูลอย่างเดียวไม่ควรมีการเขียนข้อมูลลง HosObject เพราะว่ามันจะมีการใช้ Object ใน HO ผิด Pattern
 */
public class DialogDoctorClinic extends javax.swing.JDialog 
{    
    private Vector vDoctorOff ,vClinic;   
    private LookupControl theLookupControl;    
    private ComboboxModel theComboboxModel;    
    DiagDoctorClinic theDiagDoctorClinic;  // for write only
    HosObject theHO;
    boolean actionperform = false;
    /** Creates new form DialogOrderSet */
    public DialogDoctorClinic(HosControl hc, UpdateStatus us) 
    {  
        super(us.getJFrame(),true);
        initComponents();
        setLanguage("");
        theLookupControl = hc.theLookupControl;
        theHO = hc.theHO;
        //setSize(300, 100);
        setTitle(Constant.getTextBundle("เลือกแพทย์และคลีนิก"));   
        
        vDoctorOff = theLookupControl.listDoctor();
        theComboboxModel.initComboBox(this.jComboBoxListDoctor,vDoctorOff);
        vClinic = theLookupControl.listClinic();
        theComboboxModel.initComboBox(this.jComboBoxListClinic,vClinic);
        this.jCheckBoxMemValue.setVisible(true);   
    }
    
    public void setLanguage(String msg)
    {
        GuiLang.setLanguage(jLabelDoctorName);
	GuiLang.setLanguage(jButtonOk);
        GuiLang.setLanguage(jLabelClinicName);
        GuiLang.setLanguage(jCheckBoxMemValue);
        
    }   
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jPanel1 = new javax.swing.JPanel();
        jPanelShowDoctor = new javax.swing.JPanel();
        jLabelDoctorName = new javax.swing.JLabel();
        jComboBoxListDoctor = new javax.swing.JComboBox();
        jLabelClinicName = new javax.swing.JLabel();
        jComboBoxListClinic = new javax.swing.JComboBox();
        jPanelControl = new javax.swing.JPanel();
        jButtonOk = new javax.swing.JButton();
        jCheckBoxMemValue = new javax.swing.JCheckBox();
        jLabelWarning = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jPanel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jPanel1.setLayout(new java.awt.GridBagLayout());

        jPanelShowDoctor.setLayout(new java.awt.GridBagLayout());

        jLabelDoctorName.setText("แพทย์");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanelShowDoctor.add(jLabelDoctorName, gridBagConstraints);

        jComboBoxListDoctor.setMinimumSize(new java.awt.Dimension(25, 24));
        jComboBoxListDoctor.setPreferredSize(new java.awt.Dimension(25, 24));
        jComboBoxListDoctor.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBoxListDoctorActionPerformed(evt);
            }
        });
        jComboBoxListDoctor.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jComboBoxListDoctorKeyReleased(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 0);
        jPanelShowDoctor.add(jComboBoxListDoctor, gridBagConstraints);

        jLabelClinicName.setText("คลีนิก");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 0, 0, 0);
        jPanelShowDoctor.add(jLabelClinicName, gridBagConstraints);

        jComboBoxListClinic.setMinimumSize(new java.awt.Dimension(25, 24));
        jComboBoxListClinic.setPreferredSize(new java.awt.Dimension(25, 24));
        jComboBoxListClinic.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBoxListClinicActionPerformed(evt);
            }
        });
        jComboBoxListClinic.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jComboBoxListClinicKeyReleased(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 0);
        jPanelShowDoctor.add(jComboBoxListClinic, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jPanel1.add(jPanelShowDoctor, gridBagConstraints);

        jPanelControl.setLayout(new java.awt.GridBagLayout());

        jButtonOk.setText("OK");
        jButtonOk.setMaximumSize(new java.awt.Dimension(67, 24));
        jButtonOk.setMinimumSize(new java.awt.Dimension(67, 25));
        jButtonOk.setPreferredSize(new java.awt.Dimension(67, 25));
        jButtonOk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonOkActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        jPanelControl.add(jButtonOk, gridBagConstraints);

        jCheckBoxMemValue.setText("จำค่านี้ไว้");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        jPanelControl.add(jCheckBoxMemValue, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.SOUTH;
        gridBagConstraints.insets = new java.awt.Insets(1, 5, 5, 5);
        jPanel1.add(jPanelControl, gridBagConstraints);

        jLabelWarning.setText("  ");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(3, 5, 0, 0);
        jPanel1.add(jLabelWarning, gridBagConstraints);

        getContentPane().add(jPanel1, java.awt.BorderLayout.CENTER);

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width-327)/2, (screenSize.height-145)/2, 327, 145);
    }// </editor-fold>//GEN-END:initComponents

    private void jComboBoxListClinicKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jComboBoxListClinicKeyReleased
//        jButtonOkActionPerformed(null);
        if(evt.getKeyCode() == java.awt.event.KeyEvent.VK_ENTER)
        {
            jButtonOkActionPerformed(null);
        }
    }//GEN-LAST:event_jComboBoxListClinicKeyReleased

    private void jComboBoxListDoctorKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jComboBoxListDoctorKeyReleased
//        jButtonOkActionPerformed(null);
        if(evt.getKeyCode() == java.awt.event.KeyEvent.VK_ENTER)
        {
            jButtonOkActionPerformed(null);
        }
    }//GEN-LAST:event_jComboBoxListDoctorKeyReleased

    private void jButtonOkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonOkActionPerformed
        //กรณีเป็นการบันทึก Diag ของแพทย์ให้ส่งผ่านทางตัวแปรตัวนี้
        actionperform = true;
        theDiagDoctorClinic.buseMemory = this.jCheckBoxMemValue.isSelected();
        theDiagDoctorClinic.clinic_id = Gutil.getGuiData(jComboBoxListClinic);
        
        if(this.jComboBoxListDoctor.isVisible())
            theDiagDoctorClinic.doctor_id = Gutil.getGuiData(jComboBoxListDoctor);
        else
            theDiagDoctorClinic.doctor_id = null;
        dispose();
        
    }//GEN-LAST:event_jButtonOkActionPerformed

    private void jComboBoxListDoctorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jComboBoxListDoctorActionPerformed
        
//        if(evt.getActionCommand().equals("comboBoxEdited"))
//        {
//            jButtonOkActionPerformed(null);
////            String keyword = String.valueOf(jComboBoxListDoctor.getSelectedItem());
////            vDoctorOff = theLookupControl.listDoctor(keyword);
////            theComboboxModel.initComboBox(this.jComboBoxListDoctor,vDoctorOff);
//        }

    }//GEN-LAST:event_jComboBoxListDoctorActionPerformed

    private void jComboBoxListClinicActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jComboBoxListClinicActionPerformed
        
//        if(evt.getActionCommand().equals("comboBoxEdited"))
//        {
//            jButtonOkActionPerformed(null);
////            String keyword = String.valueOf(jComboBoxListClinic.getSelectedItem());
////            vClinic = theLookupControl.listClinic(keyword);
////            theComboboxModel.initComboBox(this.jComboBoxListClinic,vClinic);
//        }

    }//GEN-LAST:event_jComboBoxListClinicActionPerformed
    
    public void eventInComboBoxListDoctor(java.awt.event.KeyEvent evt)
    {
        if(java.awt.event.KeyEvent.VK_ENTER == evt.getKeyCode())
        {
            jButtonOkActionPerformed(null);
        }
    }
    /**
     * ใช้สำหรับการให้รหัสโรคของการ map dx กับ ICD10
     * @param emp เป็น Object ของ Employee ที่ได้จากการเลือก (call by value)
     * @param clinic เป็น Object ของ Clinic ที่ได้จากการเลือก (call by value)
     * @author padungrat(tong)
     * @date 19/04/2549,10:55
     * @deprecated ต้องแก้ให้ใช้งานกับ theDiagDoctorClinic ที่เป็น local และต้องไม่ส่ง employee กับ clinic ไปให้ด้วย
     */
    public boolean showDialog(DiagDoctorClinic ddc)
    {
        Toolkit thekit = getToolkit();       
        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();        
        setLocation((screenSize.width-getSize().width)/2, (screenSize.height-getSize().height)/2);     
        
        theDiagDoctorClinic = ddc;
        if(!this.jCheckBoxMemValue.isSelected())
            setOGDiagDoctorClinic();
        else
        {
            jButtonOkActionPerformed(null);
            return true;
        }
        setVisible(true);  

        if(actionperform)
            return true;
        else 
            return false;
    }
    
    /**
     * ใช้ในการกำหนดค่าจากของเก่ามาแสดงใหม่
     * @author padungrat(tong)
     * @date 19/04/2549,16:30
     */
    private void setOGDiagDoctorClinic()
    {
        if(theDiagDoctorClinic.doctor_id !=null && !theDiagDoctorClinic.doctor_id.equals(""))
        {
            theComboboxModel.setCodeComboBox(this.jComboBoxListDoctor,theDiagDoctorClinic.doctor_id);
        }  
        if(theDiagDoctorClinic.clinic_id !=null && !theDiagDoctorClinic.clinic_id.equals(""))
        {
            theComboboxModel.setCodeComboBox(this.jComboBoxListClinic,theDiagDoctorClinic.clinic_id);
        }  
        this.jLabelWarning.setText("");
        if(theHO.theVisit!=null
            && theDiagDoctorClinic.clinic_id!=null
            && theDiagDoctorClinic.clinic_id.equals(Clinic.MED)
            && Integer.parseInt(theHO.theVisit.patient_age) < 16){
                jLabelWarning.setText("ผู้ป่วยอายุน้อยควรเลือกคลินิกกุมารเวช");
        }
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButtonOk;
    private javax.swing.JCheckBox jCheckBoxMemValue;
    private javax.swing.JComboBox jComboBoxListClinic;
    private javax.swing.JComboBox jComboBoxListDoctor;
    private javax.swing.JLabel jLabelClinicName;
    private javax.swing.JLabel jLabelDoctorName;
    private javax.swing.JLabel jLabelWarning;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanelControl;
    private javax.swing.JPanel jPanelShowDoctor;
    // End of variables declaration//GEN-END:variables
    
}
