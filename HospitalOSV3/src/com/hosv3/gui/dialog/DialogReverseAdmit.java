/*
 * DialogReverseAdmit.java
 *
 * Created on 23 เมษายน 2547, 11:16 น.
 */
package com.hosv3.gui.dialog;
import com.hosv3.utility.Constant;
import java.awt.*;

import com.hosv3.utility.*;
import com.hosv3.control.*;
import com.hosv3.utility.connection.*;
import com.hosv3.object.*;

import com.hospital_os.object.*;
import com.hospital_os.utility.ComboboxModel;
import com.hospital_os.utility.Gutil;
import javax.swing.JOptionPane;

/**
 *
 * @author  tong
 */
public class DialogReverseAdmit extends javax.swing.JDialog {
    HosObject theHO;
    HosControl theHC;
    /**ใช้ตรวจสอบว่า กดปุ่ม ok หรือเปล่า*/
    static public boolean actionCommand = true;
    /**เป็น Control ของ LookUP*/
    private SystemControl theSystemControl;
    /**เป็น Control ของ Visit ที่ใช้ในการ ย้อนกลับการ admit */
    private VisitControl theVisitControl;
    /**เก็บ object ของ visit */
    private Visit theVisit;
    /** เก็บค่าข้อมูลของ ReverseAdmit*/
    private ReverseAdmit theReverseAdmit;
    private ComboboxModel theComboboxModel; 
    /** Creates new form DialogReverseAdmit */
    public DialogReverseAdmit(HosControl hc,UpdateStatus us, boolean modal) 
    {
        super(us.getJFrame(), modal);
        theHC = hc;
        theHO = hc.theHO;
        theSystemControl = theHC.theSystemControl;
        theVisitControl = theHC.theVisitControl;
        theVisit = theHO.theVisit;
        
        initComponents();
        setLanguage("");
        jTextAreaCause.requestFocus();
        
        //amp:15/08/2549:แสดงชื่อแพทย์ให้เลือกเพื่อนำแพทย์ที่เลือกไป off ยา
        theComboboxModel.initComboBox(jComboBoxDoctor,theHC.theLookupControl.listDoctor());
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jPanel1 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        jButtonOK = new javax.swing.JButton();
        jButtonCancel = new javax.swing.JButton();
        jCheckBoxReused = new javax.swing.JCheckBox();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTextAreaCause = new javax.swing.JTextArea();
        jPanel3 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        jComboBoxDoctor = new javax.swing.JComboBox();

        getContentPane().setLayout(new java.awt.GridBagLayout());

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        jPanel1.setLayout(new java.awt.GridBagLayout());

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder("\u0e2a\u0e32\u0e40\u0e2b\u0e15\u0e38\u0e01\u0e32\u0e23\u0e22\u0e01\u0e40\u0e25\u0e34\u0e01\u0e01\u0e32\u0e23 Admit"));
        jPanel2.setLayout(new java.awt.GridBagLayout());

        jButtonOK.setText("\u0e1a\u0e31\u0e19\u0e17\u0e36\u0e01");
        jButtonOK.setPreferredSize(new java.awt.Dimension(70, 25));
        jButtonOK.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonOKActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.VERTICAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        gridBagConstraints.weightx = 1.0;
        jPanel2.add(jButtonOK, gridBagConstraints);

        jButtonCancel.setText("\u0e22\u0e01\u0e40\u0e25\u0e34\u0e01");
        jButtonCancel.setMaximumSize(new java.awt.Dimension(55, 25));
        jButtonCancel.setMinimumSize(new java.awt.Dimension(55, 25));
        jButtonCancel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonCancelActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.VERTICAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 0);
        jPanel2.add(jButtonCancel, gridBagConstraints);

        jCheckBoxReused.setSelected(true);
        jCheckBoxReused.setText("\u0e19\u0e33 AN \u0e01\u0e25\u0e31\u0e1a\u0e21\u0e32\u0e43\u0e0a\u0e49\u0e43\u0e2b\u0e21\u0e48");
        jCheckBoxReused.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxReusedActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        jPanel2.add(jCheckBoxReused, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.SOUTHEAST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(17, 12, 11, 11);
        jPanel1.add(jPanel2, gridBagConstraints);

        jScrollPane1.setMinimumSize(new java.awt.Dimension(150, 150));
        jScrollPane1.setPreferredSize(new java.awt.Dimension(250, 100));
        jTextAreaCause.setLineWrap(true);
        jTextAreaCause.setMinimumSize(new java.awt.Dimension(50, 50));
        jTextAreaCause.setPreferredSize(new java.awt.Dimension(50, 50));
        jScrollPane1.setViewportView(jTextAreaCause);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(12, 12, 0, 11);
        jPanel1.add(jScrollPane1, gridBagConstraints);

        jPanel3.setLayout(new java.awt.GridBagLayout());

        jLabel3.setText("\u0e41\u0e1e\u0e17\u0e22\u0e4c\u0e1c\u0e39\u0e49\u0e22\u0e01\u0e40\u0e25\u0e34\u0e01");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanel3.add(jLabel3, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 11, 0, 0);
        jPanel3.add(jComboBoxDoctor, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(12, 12, 0, 11);
        jPanel1.add(jPanel3, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(jPanel1, gridBagConstraints);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jCheckBoxReusedActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxReusedActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jCheckBoxReusedActionPerformed
    private void jButtonOKActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonOKActionPerformed
        if(jTextAreaCause.getText().trim().length() == 0) {  
            JOptionPane.showMessageDialog(null,"กรุณากรอกสาเหตุการยกเลิก");
            return;
        }
        setFromToObject();
        boolean res = theVisitControl.reverseAdmit(theVisit,theReverseAdmit,Gutil.getGuiData(jComboBoxDoctor));
        if(res)
            dispose();
    }//GEN-LAST:event_jButtonOKActionPerformed
    private void jButtonCancelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonCancelActionPerformed
        dispose();
    }//GEN-LAST:event_jButtonCancelActionPerformed
    private void clearData(){
        jTextAreaCause.setText("");
    }
    public static boolean showDialog(HosControl hc,UpdateStatus us, boolean modal,Visit visit){
        DialogReverseAdmit dlg = new DialogReverseAdmit(hc,us,true);//,off);
        dlg.setTitle(Constant.getTextBundle("ยืนยันการ ยกเลิก Admit"));
        Toolkit thekit = dlg.getToolkit();
        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
        dlg.setLocation((screenSize.width-dlg.getSize().width)/2, (screenSize.height-dlg.getSize().height)/2);
        dlg.setVisible(true);
        if(dlg.actionCommand){
              return true;
        }
       dlg=null;
       System.gc();
       return false;
    }
    
    public boolean showDialog(Visit visit)
    {
        setTitle(Constant.getTextBundle("ยืนยันการ ยกเลิก Admit"));
        Toolkit thekit = getToolkit();
        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
        setLocation((screenSize.width-getSize().width)/2, (screenSize.height-getSize().height)/2);
        theVisit = visit;
        clearData();
        setVisible(true);
        if(actionCommand){     
              return true;
        }
       System.gc();
       return false;
    }
    
    ////////////////////////////////////////////////////////////////////////////
    /**
     * จัดการค่าของ GUI ส่งให้ Object ReverseAdmit และ Visit
     * ก่อนจะส่งไปยัง Control
     */
    private void setFromToObject(){
        theReverseAdmit= new ReverseAdmit();
        theReverseAdmit.reverse_admit_cause = jTextAreaCause.getText();
        theReverseAdmit.visit_id = theVisit.getObjectId();
        theReverseAdmit.user_code = theHO.theEmployee.getObjectId();
        theReverseAdmit.reverse_admit_date = theHC.theLookupControl.getTextCurrentDateTime();
        
        theReverseAdmit.ward =  theVisit.ward;
        theReverseAdmit.clinic = theVisit.admit_clinic;
        theReverseAdmit.bed = theVisit.bed;
        theReverseAdmit.an = theVisit.vn;
        theReverseAdmit.begin_admit_time = theVisit.begin_admit_time;
        theReverseAdmit.used = "0";
        if(!jCheckBoxReused.isSelected())
            theReverseAdmit.used = "1";
    }
    
    public void dispose(){
        this.setVisible(false);
    }
    
    public void setLanguage(String msg)
   {   
        GuiLang.setLanguage(jButtonOK);
        GuiLang.setLanguage(jButtonCancel);
        GuiLang.setLanguage(jCheckBoxReused);
        GuiLang.setTextBundle(jPanel1);
        GuiLang.setLanguage(jLabel3);
   }
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
      
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButtonCancel;
    private javax.swing.JButton jButtonOK;
    private javax.swing.JCheckBox jCheckBoxReused;
    private javax.swing.JComboBox jComboBoxDoctor;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextArea jTextAreaCause;
    // End of variables declaration//GEN-END:variables
    
}
