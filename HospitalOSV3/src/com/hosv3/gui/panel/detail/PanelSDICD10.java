/*
 * PanelSetupICD10.java
 *
 * Created on 12 ตุลาคม 2546, 11:57น.
 */
package com.hosv3.gui.panel.detail;

import com.hospital_os.usecase.connection.Persistent;
import com.hospital_os.utility.ComboboxModel;
import com.hospital_os.utility.Gutil;
import com.hosv3.gui.component.PanelSetupImp;
import com.hosv3.utility.Constant;
import java.util.Vector;
import com.hosv3.control.*;
import com.hosv3.utility.connection.*;
import com.hosv3.utility.GuiLang;
import com.hospital_os.object.*;

/**
 *
 * @panel author : amp
 * @code author : amp
 */
public class PanelSDICD10 extends javax.swing.JPanel implements PanelSetupImp {

    UpdateStatus theUS;
    SetupControl theSetupControl;
    DiagnosisControl theDiagnosisControl;
    LookupControl theLookupControl;
    ICD10 theICD10 = new ICD10();
    Vector icd10 = new Vector();
    int offset = 24;
    int next = 0;
    int prev = 0;
    int saved = 0; // 0 คือ ไม่สามารถ insertได้ 1 คือ insert ได้ 
    String[] col = {"รหัส", "ชื่อโรค"};

    public PanelSDICD10() {
        initComponents();
        setLanguage();
    }

    public PanelSDICD10(HosControl hc, UpdateStatus us) {
        initComponents();
        setLanguage();
        setControl(hc, us);
    }     /////////////////////Use this for decrease memory usage

    /**
     *@Author : amp
     *@date : 29/02/2549
     *@see : จัดการเกี่ยวกับภาษา    
     */
    public void setLanguage() {
        GuiLang.setLanguage(jLabel3);
        GuiLang.setLanguage(jLabel1);
        GuiLang.setLanguage(jLabelActive53);
        GuiLang.setLanguage(jLabel4);
        GuiLang.setLanguage(col);
    }

    public void setControl(HosControl hc, UpdateStatus us) {
        theUS = us;

        theSetupControl = hc.theSetupControl;
        theLookupControl = hc.theLookupControl;
        theDiagnosisControl = hc.theDiagnosisControl;
        hc.theHS.theSetupSubject.addpanelrefrash(this);
        hc.theHS.theSetupSubject.addForLiftAttach(this);
        setupLookup();
    }

    public void setupLookup() {
        ComboboxModel.initComboBox(jComboBoxGenetateCode, theLookupControl.listIcd10GroupType());
    }

    /////////////////////Use this for decrease memory usage   
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        defaultFont1 = new com.hospital_os.gui.font.DefaultFont();
        fontFormatTitle1 = new com.hospital_os.gui.font.FontFormatTitle();
        tableResultsModel1 = new com.hospital_os.utility.TableResultsModel();
        jLabel1 = new javax.swing.JLabel();
        jTextFieldCode = new javax.swing.JTextField();
        jLabelActive53 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTextAreaDescription = new javax.swing.JTextArea();
        jLabel4 = new javax.swing.JLabel();
        jScrollPane3 = new javax.swing.JScrollPane();
        jTextAreaOtherDescription = new javax.swing.JTextArea();
        jComboBoxGenetateCode = new javax.swing.JComboBox();
        jLabel5 = new javax.swing.JLabel();

        setMinimumSize(new java.awt.Dimension(300, 400));
        setPreferredSize(new java.awt.Dimension(300, 400));
        setLayout(new java.awt.GridBagLayout());

        jLabel1.setFont(defaultFont1);
        java.util.ResourceBundle bundle = java.util.ResourceBundle.getBundle("com/hosv3/property/thai"); // NOI18N
        jLabel1.setText(bundle.getString("CODE")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        add(jLabel1, gridBagConstraints);

        jTextFieldCode.setColumns(10);
        jTextFieldCode.setFont(defaultFont1);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 0, 5, 5);
        add(jTextFieldCode, gridBagConstraints);

        jLabelActive53.setFont(defaultFont1);
        jLabelActive53.setText("เป็นรหัสที่ออกรายงานปี 53 ได้");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 5, 5);
        add(jLabelActive53, gridBagConstraints);

        jLabel3.setFont(defaultFont1);
        jLabel3.setText(bundle.getString("ICD10_DESCRIPTION")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 5, 5);
        add(jLabel3, gridBagConstraints);

        jTextAreaDescription.setColumns(10);
        jTextAreaDescription.setFont(defaultFont1);
        jTextAreaDescription.setLineWrap(true);
        jTextAreaDescription.setRows(3);
        jTextAreaDescription.setWrapStyleWord(true);
        jTextAreaDescription.setMinimumSize(new java.awt.Dimension(100, 45));
        jScrollPane2.setViewportView(jTextAreaDescription);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 5, 5);
        add(jScrollPane2, gridBagConstraints);

        jLabel4.setFont(defaultFont1);
        jLabel4.setText(bundle.getString("ICD10_OTHERDESCRIPTION")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 5, 5);
        add(jLabel4, gridBagConstraints);

        jTextAreaOtherDescription.setColumns(10);
        jTextAreaOtherDescription.setFont(defaultFont1);
        jTextAreaOtherDescription.setLineWrap(true);
        jTextAreaOtherDescription.setRows(3);
        jTextAreaOtherDescription.setWrapStyleWord(true);
        jTextAreaOtherDescription.setMinimumSize(new java.awt.Dimension(100, 45));
        jScrollPane3.setViewportView(jTextAreaOtherDescription);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 5, 5);
        add(jScrollPane3, gridBagConstraints);

        jComboBoxGenetateCode.setFont(defaultFont1);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 5);
        add(jComboBoxGenetateCode, gridBagConstraints);

        jLabel5.setFont(defaultFont1);
        jLabel5.setText(bundle.getString("GENERATE_CODE")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 5, 5);
        add(jLabel5, gridBagConstraints);
    }// </editor-fold>//GEN-END:initComponents

    public void clearAll() {
        this.setICD10(new ICD10());
        setEnabled(true);
    }

    public void setEnabled(boolean var) {
        jTextFieldCode.setEditable(var);
        jComboBoxGenetateCode.setEnabled(var);
        jTextAreaDescription.setEditable(var);
        jTextAreaOtherDescription.setEditable(var);
    }

    public void setICD10(ICD10 icd) {
        theICD10 = icd;
        jTextFieldCode.setText(theICD10.icd10_id);
        ComboboxModel.setCodeComboBox(jComboBoxGenetateCode, theICD10.generate_code);
        jTextAreaOtherDescription.setText(theICD10.other_description);
        jTextAreaDescription.setText(theICD10.description);
        jLabelActive53.setVisible(theICD10.active53.equals("1"));
        //konshow
        if (icd != null && icd.getCode()!=null && icd.getCode().substring(3, 8).equals(theLookupControl.readSite().off_id)) {
                setEnabled(true);
        } else {
            setEnabled(false);
        }
    }

    public ICD10 getICD10() {
        theICD10.icd10_id = jTextFieldCode.getText();
        theICD10.generate_code = Gutil.getGuiData(jComboBoxGenetateCode);
        theICD10.description = jTextAreaDescription.getText();
        theICD10.other_description = jTextAreaOtherDescription.getText();
        return theICD10;
    }

    public Persistent getXPer() {
        return this.getICD10();
    }

    public void setXPer(Persistent x) {
        this.setICD10((ICD10) x);
    }
/**
 * henbe comment 100253 kong ผิด pattern if return  และเขียนโค้ดซับซ้อนเข้าใจยาก ใช้บรรทัดยาวเกินไป
 * konshow edit for comment
 * @param x
 * @return
 */
    public boolean deleteXPer(Persistent x) {
        //konshow
        ICD10 delICD10 = (ICD10) x;
        if (delICD10 == null || delICD10.getCode() == null || !delICD10.getCode().substring(3, 8).equals(theLookupControl.readSite().off_id)) {
            theUS.setStatus("ICD10 ตัวนี้ไม่อนุญาติให้ทำการลบได้", theUS.WARNING);
            return false;
        }
        boolean confirm = theUS.confirmBox("ยืนยันที่จะลบรายการนี้ อาจเกิดผลกระทบกับข้อมูลในฐานข้อมูลได้", UpdateStatus.WARNING);
        if (!confirm) {
            return false;
        }
        return (theSetupControl.deleteICD10(delICD10) > 0);
    }

    public boolean saveXPer(Persistent x) {
        return this.theSetupControl.saveICD10((ICD10) x) > 0;
    }

    public Vector listXPer(String key, String active, int offset) {
        return theDiagnosisControl.listIcd10ByIdNameGroup(key, null);
    }

    public boolean isActiveVisible() {
        return false;
    }
    public static String TITLE = Constant.getTextBundle("PANEL_SETUP_ICD10");

    public String getTitle() {
        return TITLE;
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private com.hospital_os.gui.font.DefaultFont defaultFont1;
    private com.hospital_os.gui.font.FontFormatTitle fontFormatTitle1;
    private javax.swing.JComboBox jComboBoxGenetateCode;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabelActive53;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JTextArea jTextAreaDescription;
    private javax.swing.JTextArea jTextAreaOtherDescription;
    private javax.swing.JTextField jTextFieldCode;
    private com.hospital_os.utility.TableResultsModel tableResultsModel1;
    // End of variables declaration//GEN-END:variables
}
