/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * PDItemDrug.java
 *
 * Created on 5 ก.ค. 2553, 17:41:29
 */

package com.hosv3.gui.panel.detail;

import com.hospital_os.object.Drug;
import com.hospital_os.utility.Gutil;
import com.hosv3.control.HosControl;
import com.hosv3.control.lookup.DoseUomLookup;
import com.hosv3.control.lookup.DrugFrequencyLookup;
import com.hosv3.control.lookup.DrugInstructionLookup;
import com.hosv3.object.DrugFrequency2;
import com.hosv3.object.DrugInstruction2;
import com.hosv3.object.Uom2;
import com.hosv3.utility.connection.UpdateStatus;
import java.awt.CardLayout;

/**
 *
 * @author henbe
 */
public class PDItemDrug extends javax.swing.JPanel {
    private Drug theDrug;
    private HosControl theHC;
    private UpdateStatus theUS;

    /** Creates new form PDItemDrug */
    public PDItemDrug() {
        initComponents();
        //ปิดอาการที่อาจจะแพ้ไว้เนื่องจากไม่ได้ใช้งานjPanel16
        jLabel20.setVisible(false);
        jTextAreaAllergy.setVisible(false);
    }
    public void setControl(HosControl hc,UpdateStatus us){
        theHC = hc;
        theUS = us;
        jComboBoxUseMethod.setControl(null, new DrugFrequencyLookup(theHC.theLookupControl), new DrugFrequency2());
        jComboBoxTimeUse.setControl(null, new DrugInstructionLookup(theHC.theLookupControl), new DrugInstruction2());
        jComboBoxQtyUse.setControl(null, new DoseUomLookup(theHC.theLookupControl), new Uom2());
        jComboBoxQtyPay.setControl(null, new DoseUomLookup(theHC.theLookupControl), new Uom2());
    }
    public String checkRequireField() {
        String err = "0";
        if (jTextFieldQtyPay.getText().equals("")) {
            jTextFieldQtyPay.requestFocus();
            theUS.setStatus("กรุณากรอกปริมาณที่จ่าย", UpdateStatus.WARNING);
            err = "1";
        } else if (jTextFieldQtyUse.getText().equals("")) {
            jTextFieldQtyUse.requestFocus();
            theUS.setStatus("กรุณากรอกปริมาณใช้", UpdateStatus.WARNING);
            err = "1";
        } else if (jComboBoxQtyPay.getText().equals("")) {
            jComboBoxQtyPay.requestFocus();
            theUS.setStatus("กรุณากรอกหน่วยของปริมาณที่จ่าย", UpdateStatus.WARNING);
            err = "1";
        } else if (jComboBoxTimeUse.getText().equals("151000003031592992")) {
            jComboBoxTimeUse.requestFocus();
            theUS.setStatus("กรุณาเลือกวิธีใช้", UpdateStatus.WARNING);
            err = "1";
        } else if (jComboBoxUseMethod.getText().equals("150000005538787924")) {
            jComboBoxUseMethod.requestFocus();
            theUS.setStatus("กรุณาเลือกว่าใช้เวลาเท่าไหร่", UpdateStatus.WARNING);
            err = "1";
        } else if (jTextAreaWarn.getText().equals("")) {
            jTextAreaWarn.requestFocus();
            theUS.setStatus("กรุณากรอกคำเตือน", UpdateStatus.WARNING);
            err = "1";
        } else if (jTextAreaDescription.getText().equals("")) {
            jTextAreaDescription.requestFocus();
            theUS.setStatus("กรุณากรอกรายละเอียด", UpdateStatus.WARNING);
            err = "1";
        }
        return err;
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jLabel14 = new javax.swing.JLabel();
        jLabel17 = new javax.swing.JLabel();
        jLabel18 = new javax.swing.JLabel();
        jScrollPane6 = new javax.swing.JScrollPane();
        jTextAreaWarn = new javax.swing.JTextArea();
        jLabel19 = new javax.swing.JLabel();
        jScrollPane7 = new javax.swing.JScrollPane();
        jTextAreaDescription = new javax.swing.JTextArea();
        jCheckBoxCanPrint = new javax.swing.JCheckBox();
        jTextFieldQtyPay = new com.hospital_os.utility.DoubleTextField();
        jComboBoxQtyPay = new com.hosv3.gui.component.HosComboBox();
        jPanel16 = new javax.swing.JPanel();
        jLabel8 = new javax.swing.JLabel();
        jTextFieldUnitPack = new javax.swing.JTextField();
        jLabel20 = new javax.swing.JLabel();
        jScrollPane8 = new javax.swing.JScrollPane();
        jTextAreaAllergy = new javax.swing.JTextArea();
        jPanelCard = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        jComboBoxTimeUse = new com.hosv3.gui.component.HosComboBox();
        jLabel15 = new javax.swing.JLabel();
        jComboBoxUseMethod = new com.hosv3.gui.component.HosComboBox();
        jLabel16 = new javax.swing.JLabel();
        jTextFieldQtyUse = new com.hospital_os.utility.DoubleTextField();
        jComboBoxQtyUse = new com.hosv3.gui.component.HosComboBox();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTextAreaSpecial = new javax.swing.JTextArea();
        jCheckBoxSpecial = new javax.swing.JCheckBox();

        setLayout(new java.awt.GridBagLayout());

        java.util.ResourceBundle bundle = java.util.ResourceBundle.getBundle("com/hosv3/property/thai"); // NOI18N
        jLabel14.setText(bundle.getString("METHOD_USE")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.EAST;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 2, 2);
        add(jLabel14, gridBagConstraints);

        jLabel17.setText(bundle.getString("QTY_PAY")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 2, 2);
        add(jLabel17, gridBagConstraints);

        jLabel18.setText(bundle.getString("WARN")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 2, 2);
        add(jLabel18, gridBagConstraints);

        jScrollPane6.setMaximumSize(new java.awt.Dimension(150, 48));
        jScrollPane6.setMinimumSize(new java.awt.Dimension(150, 45));
        jScrollPane6.setPreferredSize(new java.awt.Dimension(150, 45));
        jScrollPane6.setViewportView(jTextAreaWarn);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(2, 2, 2, 5);
        add(jScrollPane6, gridBagConstraints);

        jLabel19.setText(bundle.getString("DETAIL_COL")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 7;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 2, 2);
        add(jLabel19, gridBagConstraints);

        jScrollPane7.setMaximumSize(new java.awt.Dimension(150, 48));
        jScrollPane7.setMinimumSize(new java.awt.Dimension(150, 45));
        jScrollPane7.setPreferredSize(new java.awt.Dimension(150, 45));
        jScrollPane7.setViewportView(jTextAreaDescription);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 7;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 2, 2, 5);
        add(jScrollPane7, gridBagConstraints);

        jCheckBoxCanPrint.setSelected(true);
        jCheckBoxCanPrint.setText("พิมพ์สติ๊กเกอร์");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 9;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 2, 2);
        add(jCheckBoxCanPrint, gridBagConstraints);

        jTextFieldQtyPay.setHorizontalAlignment(javax.swing.JTextField.TRAILING);
        jTextFieldQtyPay.setText("1");
        jTextFieldQtyPay.setMinimumSize(new java.awt.Dimension(40, 21));
        jTextFieldQtyPay.setPreferredSize(new java.awt.Dimension(40, 21));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.insets = new java.awt.Insets(2, 2, 2, 2);
        add(jTextFieldQtyPay, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 2, 2, 2);
        add(jComboBoxQtyPay, gridBagConstraints);

        jPanel16.setToolTipText("รายงาน 18 แฟ้ม 53");
        jPanel16.setLayout(new java.awt.GridBagLayout());

        jLabel8.setText("จำนวนในหน่วยนับ");
        jLabel8.setMaximumSize(new java.awt.Dimension(1, 1));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanel16.add(jLabel8, gridBagConstraints);

        jTextFieldUnitPack.setHorizontalAlignment(javax.swing.JTextField.TRAILING);
        jTextFieldUnitPack.setToolTipText("");
        jTextFieldUnitPack.setMinimumSize(new java.awt.Dimension(50, 26));
        jTextFieldUnitPack.setPreferredSize(new java.awt.Dimension(50, 26));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 0);
        jPanel16.add(jTextFieldUnitPack, gridBagConstraints);

        jLabel20.setText("อาการที่อาจจะแพ้");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(5, 0, 5, 5);
        jPanel16.add(jLabel20, gridBagConstraints);

        jScrollPane8.setMinimumSize(new java.awt.Dimension(25, 50));
        jScrollPane8.setPreferredSize(new java.awt.Dimension(25, 50));

        jTextAreaAllergy.setMinimumSize(new java.awt.Dimension(0, 21));
        jTextAreaAllergy.setPreferredSize(new java.awt.Dimension(0, 21));
        jScrollPane8.setViewportView(jTextAreaAllergy);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        jPanel16.add(jScrollPane8, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 8;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 5);
        add(jPanel16, gridBagConstraints);

        jPanelCard.setLayout(new java.awt.CardLayout());

        jPanel2.setLayout(new java.awt.GridBagLayout());
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 2, 5);
        jPanel2.add(jComboBoxTimeUse, gridBagConstraints);

        jLabel15.setText(bundle.getString("TIME_USE")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 2, 2);
        jPanel2.add(jLabel15, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 2, 5);
        jPanel2.add(jComboBoxUseMethod, gridBagConstraints);

        jLabel16.setText(bundle.getString("QTY_USE")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 2, 2);
        jPanel2.add(jLabel16, gridBagConstraints);

        jTextFieldQtyUse.setHorizontalAlignment(javax.swing.JTextField.TRAILING);
        jTextFieldQtyUse.setText("1");
        jTextFieldQtyUse.setMinimumSize(new java.awt.Dimension(40, 21));
        jTextFieldQtyUse.setPreferredSize(new java.awt.Dimension(40, 21));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.insets = new java.awt.Insets(2, 2, 2, 2);
        jPanel2.add(jTextFieldQtyUse, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 2, 2, 2);
        jPanel2.add(jComboBoxQtyUse, gridBagConstraints);

        jPanelCard.add(jPanel2, "normal");

        jTextAreaSpecial.setColumns(20);
        jTextAreaSpecial.setRows(5);
        jScrollPane1.setViewportView(jTextAreaSpecial);

        jPanelCard.add(jScrollPane1, "special");

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 5);
        add(jPanelCard, gridBagConstraints);

        jCheckBoxSpecial.setText("แบบพิเศษ");
        jCheckBoxSpecial.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jCheckBoxSpecialActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 2, 0);
        add(jCheckBoxSpecial, gridBagConstraints);
    }// </editor-fold>//GEN-END:initComponents

    private void jCheckBoxSpecialActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jCheckBoxSpecialActionPerformed
        this.showCard(jCheckBoxSpecial.isSelected());
    }//GEN-LAST:event_jCheckBoxSpecialActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JCheckBox jCheckBoxCanPrint;
    private javax.swing.JCheckBox jCheckBoxSpecial;
    private com.hosv3.gui.component.HosComboBox jComboBoxQtyPay;
    private com.hosv3.gui.component.HosComboBox jComboBoxQtyUse;
    private com.hosv3.gui.component.HosComboBox jComboBoxTimeUse;
    private com.hosv3.gui.component.HosComboBox jComboBoxUseMethod;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel18;
    private javax.swing.JLabel jLabel19;
    private javax.swing.JLabel jLabel20;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JPanel jPanel16;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanelCard;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane6;
    private javax.swing.JScrollPane jScrollPane7;
    private javax.swing.JScrollPane jScrollPane8;
    private javax.swing.JTextArea jTextAreaAllergy;
    private javax.swing.JTextArea jTextAreaDescription;
    private javax.swing.JTextArea jTextAreaSpecial;
    private javax.swing.JTextArea jTextAreaWarn;
    private com.hospital_os.utility.DoubleTextField jTextFieldQtyPay;
    private com.hospital_os.utility.DoubleTextField jTextFieldQtyUse;
    private javax.swing.JTextField jTextFieldUnitPack;
    // End of variables declaration//GEN-END:variables

    public void clearAll() {
        this.theDrug = null;
        jTextFieldQtyUse.setText("");
        jTextFieldQtyPay.setText("");
        jTextAreaWarn.setText("");
        jTextAreaDescription.setText("");
    }
    public void showCard(boolean special){
        CardLayout card = (CardLayout)jPanelCard.getLayout();
        if(special)
            card.show(jPanelCard, "special");
        else
            card.show(jPanelCard, "normal");
    }
    public void setDrug(Drug d) {
        theDrug = d;
        jCheckBoxCanPrint.setSelected(false);
        if (theDrug != null) {
            jComboBoxTimeUse.setText(theDrug.instruction);
            jComboBoxUseMethod.setText(theDrug.frequency);
            jTextFieldQtyUse.setText(theDrug.dose);
            jComboBoxQtyUse.setText(theDrug.use_uom);
            jTextFieldQtyPay.setText(theDrug.qty);
            jComboBoxQtyPay.setText(theDrug.purch_uom);
            jTextAreaWarn.setText(theDrug.caution);
            jTextAreaDescription.setText(theDrug.description);
            if (theDrug.printting.equals("1")) {
                jCheckBoxCanPrint.setSelected(true);
            }
            jCheckBoxSpecial.setSelected(theDrug.usage_special.equals("1"));
            showCard(theDrug.usage_special.equals("1"));
            jTextAreaSpecial.setText(theDrug.usage_text);
        } else {
            jComboBoxTimeUse.setText("");
            jComboBoxUseMethod.setText("");
            jTextFieldQtyUse.setText("");
            jComboBoxQtyUse.setText("");
            jTextFieldQtyPay.setText("");
            jComboBoxQtyPay.setText("");
            jTextAreaWarn.setText("");
            jTextAreaDescription.setText("");
            jCheckBoxCanPrint.setSelected(false);
            jCheckBoxSpecial.setSelected(false);
            jTextAreaSpecial.setText(""); 
            jCheckBoxSpecial.setSelected(false);
            showCard(false);
        }
    }
    public Drug getDrug() {
        if (theDrug == null) {
//            return null;
            theDrug = new Drug();// somprasong fix 090810 fix bug
        }
        theDrug.frequency = jComboBoxUseMethod.getText();
        theDrug.instruction = jComboBoxTimeUse.getText();
        theDrug.dose = jTextFieldQtyUse.getText();
        theDrug.use_uom = jComboBoxQtyUse.getText();
        theDrug.qty = jTextFieldQtyPay.getText();
        theDrug.purch_uom = jComboBoxQtyPay.getText();
        theDrug.caution = Gutil.CheckReservedWords(jTextAreaWarn.getText());
        theDrug.description = Gutil.CheckReservedWords(jTextAreaDescription.getText());
        theDrug.printting = jCheckBoxCanPrint.isSelected()?"1":"0";
        theDrug.usage_special = jCheckBoxSpecial.isSelected()?"1":"0";
        if(jCheckBoxSpecial.isSelected())
            theDrug.usage_text = Gutil.CheckReservedWords(jTextAreaSpecial.getText());
        return theDrug;
    }

    public String getUnitPack() {
        return Gutil.getGuiData(this.jTextFieldUnitPack);
    }

    public void setUnitPack(String up) {
        Gutil.setGuiData(this.jTextFieldUnitPack, up);
    }
}
