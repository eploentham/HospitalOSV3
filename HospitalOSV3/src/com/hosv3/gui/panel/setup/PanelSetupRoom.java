/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package com.hosv3.gui.panel.setup;

import com.hospital_os.object.Item;
import com.hospital_os.object.ServicePoint;
import com.hospital_os.object.Ward;
import com.hospital_os.usecase.connection.UpdateStatus;
import com.hospital_os.utility.TaBleModel;
import com.hosv3.control.HosControl;
import com.hosv3.gui.dialog.PanelAddBed;
import com.hosv3.gui.dialog.PanelAddRoomItem;
import com.hosv3.object.Bed;
import com.hosv3.object.Room;
import java.awt.event.KeyEvent;
import java.util.Vector;

/**
 *
 * @author LionHeartV
 * 1.  60-10-23 เรื่อง ห้อง     Hospital OS เข้าใจว่า ไม่มีห้อง
 * Modify doc 6.
 */
public class PanelSetupRoom extends javax.swing.JPanel {
    private Vector theServicePointV;
    Ward theServicePoint;
    Room theRoom;
    Item theItem;
    /**
     * Creates new form PanelSetupRoom
     */
    String[] col_servicepoint = {"จุดบริการ"};
    String[] col_room = {"ห้อง"};
    String[] col_bed = {"เตียง"};
    HosControl theHC;
    private Vector theRoomV;
    private PanelAddBed thePanelAddBed;
    private Vector theBedV;
    private PanelAddRoomItem thePanelAddRoomItem;
    public PanelSetupRoom() {
        initComponents();
    }
    public void setControl(HosControl hc)
    {
        theHC = hc;
        Vector v = theHC.theLookupControl.listWard();
        setServicePointV(v);
        jScrollPane3.setVisible(false);
        jPanel4.setVisible(false);
    }
    public void setRoom(Room room)
    {
        theRoom = room;
        if(theRoom == null)
        {
            theRoom = new Room();
            jScrollPane3.setVisible(false);
            jPanel4.setVisible(false);
            theItem = null;
            jLabel2.setText("-");
        }
        else
        {
            jScrollPane3.setVisible(true);
            jPanel4.setVisible(true);
        }
        Item item = theHC.theLookupControl.readItemById(theRoom.b_item_id);
        if(item !=null)
        {
            theItem = item;
            jLabel2.setText(item.common_name);
        }
        else
        {
            theItem = null;
            jLabel2.setText("");
        }
        jTextFieldRoomName.setText(theRoom.visit_room_number);
        if(theRoom.visit_room_active.equals("1"))
            jCheckBoxActive.setSelected(true);
        else
            jCheckBoxActive.setSelected(false);
        if(theRoom.public_room.equals("1"))
            jCheckBoxPublicRoom.setSelected(true);
        else
            jCheckBoxPublicRoom.setSelected(false);
    }
    public Room getRoom()
    {
        if(theRoom == null)
            theRoom = new Room();
        theRoom.b_visit_ward_id = theServicePoint.getObjectId();
        theRoom.visit_room_number = jTextFieldRoomName.getText();
        if(jCheckBoxActive.isSelected())
            theRoom.visit_room_active = "1";
        else
            theRoom.visit_room_active = "0";
        if(jCheckBoxPublicRoom.isSelected())
            theRoom.public_room = "1";
        else
            theRoom.public_room = "0";
        if(theItem!=null)
            theRoom.b_item_id = theItem.getObjectId();
        return theRoom;
    }
    public void setServicePointV(Vector v)
    {
        theServicePointV = v;
        TaBleModel tm = null;
        if(theServicePointV == null)
        {
            theServicePointV = new Vector();
        }
        tm = new TaBleModel(col_servicepoint,theServicePointV.size());
        for(int i=0;i<theServicePointV.size();i++)
        {
            Ward tmp = (Ward) theServicePointV.get(i);
            tm.setValueAt(tmp.description, i, 0);
        }
        jTableServicePoint.setModel(tm);
    }
    public void setRoomV(Vector v)
    {
        theRoomV = v;
        if(theRoomV == null)
            theRoomV = new Vector();
        if(theRoomV == null)
        {
            theRoomV = new Vector();
        }
        TaBleModel tm = new TaBleModel(col_room,theRoomV.size());
        for(int i=0;i<theRoomV.size();i++)
        {
            Room tmp = (Room) theRoomV.get(i);
            tm.setValueAt(tmp.visit_room_number, i, 0);
        }
        jTableRoom.setModel(tm);
    }
    public void setBedV(Vector v)
    {
        theBedV = v;
        if(theBedV == null)
            theBedV = new Vector();
        TaBleModel tm = new TaBleModel(col_bed,theBedV.size());
        for(int i=0;i<theBedV.size();i++)
        {
            Bed bed = (Bed) theBedV.get(i);
            tm.setValueAt(bed.visit_bed_number, i, 0);
        }
        jTableBed.setModel(tm);
    }
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jScrollPane1 = new javax.swing.JScrollPane();
        jTableServicePoint = new javax.swing.JTable();
        jPanel1 = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTableRoom = new javax.swing.JTable();
        jPanel2 = new javax.swing.JPanel();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        jScrollPane3 = new javax.swing.JScrollPane();
        jTableBed = new javax.swing.JTable();
        jTextFieldRoomName = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        jPanel4 = new javax.swing.JPanel();
        jButton3 = new javax.swing.JButton();
        jButton4 = new javax.swing.JButton();
        jPanel5 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jCheckBoxActive = new javax.swing.JCheckBox();
        jButton5 = new javax.swing.JButton();
        jCheckBoxPublicRoom = new javax.swing.JCheckBox();
        jPanel6 = new javax.swing.JPanel();

        setLayout(new java.awt.GridBagLayout());

        jScrollPane1.setMinimumSize(new java.awt.Dimension(100, 23));
        jScrollPane1.setPreferredSize(new java.awt.Dimension(100, 404));

        jTableServicePoint.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {

            }
        ));
        jTableServicePoint.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseReleased(java.awt.event.MouseEvent evt) {
                jTableServicePointMouseReleased(evt);
            }
        });
        jScrollPane1.setViewportView(jTableServicePoint);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.VERTICAL;
        gridBagConstraints.weighty = 1.0;
        add(jScrollPane1, gridBagConstraints);

        jPanel1.setLayout(new java.awt.GridBagLayout());

        jScrollPane2.setMinimumSize(new java.awt.Dimension(100, 23));
        jScrollPane2.setPreferredSize(new java.awt.Dimension(100, 404));

        jTableRoom.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {

            }
        ));
        jTableRoom.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseReleased(java.awt.event.MouseEvent evt) {
                jTableRoomMouseReleased(evt);
            }
        });
        jScrollPane2.setViewportView(jTableRoom);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridheight = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.VERTICAL;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 0);
        jPanel1.add(jScrollPane2, gridBagConstraints);

        jPanel2.setLayout(new java.awt.GridBagLayout());

        jButton1.setText("+");
        jButton1.setMargin(new java.awt.Insets(0, 0, 0, 0));
        jButton1.setMaximumSize(new java.awt.Dimension(46, 29));
        jButton1.setMinimumSize(new java.awt.Dimension(46, 29));
        jButton1.setPreferredSize(new java.awt.Dimension(46, 29));
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.LINE_START;
        jPanel2.add(jButton1, gridBagConstraints);

        jButton2.setText("Save");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.LINE_END;
        gridBagConstraints.weightx = 1.0;
        jPanel2.add(jButton2, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.FIRST_LINE_START;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 0);
        jPanel1.add(jPanel2, gridBagConstraints);

        jPanel3.setLayout(new java.awt.GridBagLayout());

        jTableBed.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {

            }
        ));
        jScrollPane3.setViewportView(jTableBed);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridy = 2;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 0);
        jPanel3.add(jScrollPane3, gridBagConstraints);

        jTextFieldRoomName.setMinimumSize(new java.awt.Dimension(200, 28));
        jTextFieldRoomName.setPreferredSize(new java.awt.Dimension(200, 28));
        jTextFieldRoomName.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTextFieldRoomNameKeyReleased(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.FIRST_LINE_START;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 0);
        jPanel3.add(jTextFieldRoomName, gridBagConstraints);

        jLabel1.setText("ชื่อห้อง");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.FIRST_LINE_START;
        gridBagConstraints.insets = new java.awt.Insets(10, 5, 0, 0);
        jPanel3.add(jLabel1, gridBagConstraints);

        jPanel4.setLayout(new java.awt.GridBagLayout());

        jButton3.setText("+");
        jButton3.setMargin(new java.awt.Insets(0, 0, 0, 0));
        jButton3.setMaximumSize(new java.awt.Dimension(46, 29));
        jButton3.setMinimumSize(new java.awt.Dimension(46, 29));
        jButton3.setPreferredSize(new java.awt.Dimension(46, 29));
        jButton3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton3ActionPerformed(evt);
            }
        });
        jPanel4.add(jButton3, new java.awt.GridBagConstraints());

        jButton4.setText("-");
        jButton4.setMaximumSize(new java.awt.Dimension(46, 29));
        jButton4.setMinimumSize(new java.awt.Dimension(46, 29));
        jButton4.setPreferredSize(new java.awt.Dimension(46, 29));
        jButton4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton4ActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        jPanel4.add(jButton4, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.FIRST_LINE_START;
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 0, 5);
        jPanel3.add(jPanel4, gridBagConstraints);

        jPanel5.setLayout(new java.awt.GridBagLayout());

        jLabel2.setText("รายการตรวจรักษา");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(2, 5, 0, 0);
        jPanel5.add(jLabel2, gridBagConstraints);

        jCheckBoxActive.setText("Active");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanel5.add(jCheckBoxActive, gridBagConstraints);

        jButton5.setText("+");
        jButton5.setMargin(new java.awt.Insets(0, 0, 0, 0));
        jButton5.setMaximumSize(new java.awt.Dimension(46, 29));
        jButton5.setMinimumSize(new java.awt.Dimension(46, 29));
        jButton5.setPreferredSize(new java.awt.Dimension(46, 29));
        jButton5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5ActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 1;
        jPanel5.add(jButton5, gridBagConstraints);

        jCheckBoxPublicRoom.setText("ห้องรวม");
        jPanel5.add(jCheckBoxPublicRoom, new java.awt.GridBagConstraints());

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.FIRST_LINE_START;
        gridBagConstraints.weightx = 1.0;
        jPanel3.add(jPanel5, gridBagConstraints);

        jPanel6.setLayout(new java.awt.GridBagLayout());
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.weighty = 1.0;
        jPanel3.add(jPanel6, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridheight = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel1.add(jPanel3, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        add(jPanel1, gridBagConstraints);
    }// </editor-fold>//GEN-END:initComponents

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        this.setRoom(null);
        jTextFieldRoomName.requestFocus();
    }//GEN-LAST:event_jButton1ActionPerformed

    private void jTableServicePointMouseReleased(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTableServicePointMouseReleased
        int row = jTableServicePoint.getSelectedRow();
        theServicePoint = (Ward) theServicePointV.get(row);
        Vector v = theHC.theSetupControl.listRoomByWard(theServicePoint.getObjectId());
        setRoomV(v);
        setRoom(null);
    }//GEN-LAST:event_jTableServicePointMouseReleased

    private void jTableRoomMouseReleased(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTableRoomMouseReleased
        int row = jTableRoom.getSelectedRow();
        Room room = (Room) theRoomV.get(row);
        setRoom(room);
        Vector v = theHC.theSetupControl.listBedByRoom(theRoom.getObjectId());
        setBedV(v);
    }//GEN-LAST:event_jTableRoomMouseReleased

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        getRoom();
        int res = theHC.theSetupControl.saveRoom(theRoom);
        if(res == 3)
        {
            jTextFieldRoomName.requestFocus();
            theHC.theUS.setStatus("กรุณาระบุชื่อห้อง",UpdateStatus.WARNING);
            return;
        }
        Vector v = theHC.theSetupControl.listRoomByWard(theServicePoint.getObjectId());
        setRoomV(v);
    }//GEN-LAST:event_jButton2ActionPerformed

    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
        if(thePanelAddBed == null)
        {
            thePanelAddBed = new PanelAddBed();
            thePanelAddBed.setControl(theHC);
        }
        thePanelAddBed.showDialog(theServicePoint, theRoom);
        Vector v = theHC.theSetupControl.listBedByRoom(theRoom.getObjectId());
        setBedV(v);
    }//GEN-LAST:event_jButton3ActionPerformed

    private void jButton4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton4ActionPerformed
        int row = jTableBed.getSelectedRow();
        Bed bed = (Bed) theBedV.get(row);
        bed.visit_bed_active = "0";
        theHC.theSetupControl.saveBed(bed);
//        theHC.theSetupControl.deleteBed(bed);
        Vector v = theHC.theSetupControl.listBedByRoom(theRoom.getObjectId());
        setBedV(v);
    }//GEN-LAST:event_jButton4ActionPerformed

    private void jButton5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5ActionPerformed
        if(thePanelAddRoomItem == null)
        {
            thePanelAddRoomItem = new PanelAddRoomItem();
            thePanelAddRoomItem.setControl(theHC);
        }
        theItem = null;
        thePanelAddRoomItem.showDialog();
        if(thePanelAddRoomItem.theItem != null)
        {
            jLabel2.setText(thePanelAddRoomItem.theItem.common_name);
            theItem = thePanelAddRoomItem.theItem;
        }
    }//GEN-LAST:event_jButton5ActionPerformed

    private void jTextFieldRoomNameKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTextFieldRoomNameKeyReleased
        if(evt.getKeyCode() == KeyEvent.VK_ENTER)
            jButton2ActionPerformed(null);
    }//GEN-LAST:event_jTextFieldRoomNameKeyReleased

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton3;
    private javax.swing.JButton jButton4;
    private javax.swing.JButton jButton5;
    private javax.swing.JCheckBox jCheckBoxActive;
    private javax.swing.JCheckBox jCheckBoxPublicRoom;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JTable jTableBed;
    private javax.swing.JTable jTableRoom;
    private javax.swing.JTable jTableServicePoint;
    private javax.swing.JTextField jTextFieldRoomName;
    // End of variables declaration//GEN-END:variables
}
