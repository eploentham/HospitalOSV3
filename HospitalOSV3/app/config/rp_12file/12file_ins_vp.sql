SELECT 	t_patient.patient_hn AS HN  	, b_contract_plans.contract_plans_pttype AS INSCL  	, b_contract_plans.contract_plans_pttype AS SUBTYPE  	, t_visit_payment.visit_payment_card_number AS CID  	, CASE WHEN (length(t_visit_payment.visit_payment_card_issue_date)>=10)then to_char(to_date(to_number(substr(t_visit_payment.visit_payment_card_issue_date,1,4),'9999')-543 || substr(t_visit_payment.visit_payment_card_issue_date,5,6),'yyyy-mm-dd'),'yyyymmdd')                     ELSE ''   END AS DATEIN  	, CASE WHEN (length(t_visit_payment.visit_payment_card_expire_date)>=10)then to_char(to_date(to_number(substr(t_visit_payment.visit_payment_card_expire_date,1,4),'9999')-543 || substr(t_visit_payment.visit_payment_card_expire_date,5,6),'yyyy-mm-dd'),'yyyymmdd')                     ELSE ''   END AS DATEEXP 	, CASE 		WHEN t_visit_payment.visit_payment_main_hospital <> 'null' 			THEN t_visit_payment.visit_payment_main_hospital 		ELSE ''  END AS HOSPMAIN	,CASE  		WHEN   t_visit_payment.visit_payment_sub_hospital <> 'null' 			THEN t_visit_payment.visit_payment_sub_hospital 		ELSE ''  END AS HOSPSUB  FROM 	t_patient	INNER JOIN t_visit ON (t_patient.t_patient_id = t_visit.t_patient_id) 	LEFT JOIN t_visit_payment ON (t_visit.t_visit_id = t_visit_payment.t_visit_id		AND t_visit_payment.visit_payment_priority = '0'		AND t_visit_payment.visit_payment_active = '1' ) 	LEFT JOIN b_contract_plans ON (t_visit_payment.b_contract_plans_id = b_contract_plans.b_contract_plans_id)   WHERE t_visit.f_visit_status_id <> '4'  	AND substring(t_visit.visit_begin_visit_time,1,10) >= ?	AND substring(t_visit.visit_begin_visit_time,1,10) <= ?group by	 HN  	, INSCL  	, SUBTYPE  	, CID  	, DATEIN  	, DATEEXP 	, HOSPMAIN	, HOSPSUB ORDER BY HN
