SELECT	t_patient.patient_hn AS HN	,t_visit.visit_vn AS AN	, CASE WHEN (length(t_visit.visit_begin_admit_date_time)>=10)                then to_char(to_date(to_number(                        substr(t_visit.visit_begin_admit_date_time,1,4),'9999')-543 ||                        substr(t_visit.visit_begin_admit_date_time,5,6),'yyyy-mm-dd'),'yyyymmdd')                ELSE ''   END AS DATEADM	, CASE  WHEN (Length(t_visit.visit_begin_admit_date_time) >=16 )                THEN replace(replace(substring(t_visit.visit_begin_admit_date_time from 12 for 5 ),':',''),'.','')                ELSE '' END AS TIMEADM	, CASE WHEN (length(t_visit.visit_staff_doctor_discharge_date_time)>=10)                then to_char(to_date(to_number(                        substr(t_visit.visit_staff_doctor_discharge_date_time,1,4),'9999')-543 ||                        substr(t_visit.visit_staff_doctor_discharge_date_time,5,6),'yyyy-mm-dd'),'yyyymmdd')                ELSE ''   END AS DATEDSC	, CASE  WHEN (Length(t_visit.visit_staff_doctor_discharge_date_time) >=16 )                THEN replace(replace(substring(t_visit.visit_staff_doctor_discharge_date_time from 12 for 5 ),':',''),'.','')                ELSE '' END AS TIMEDSC	,t_visit.f_visit_ipd_discharge_status_id AS DSCS	,t_visit.f_visit_ipd_discharge_type_id AS DSCT	,(t_visit.f_visit_type_id || b_report_12files_map_clinic.b_report_12files_std_clinic_id || '1') AS WARDDSC	,CASE WHEN b_report_12files_map_clinic.b_report_12files_std_clinic_id is not null                THEN b_report_12files_map_clinic.b_report_12files_std_clinic_id                ELSE '' END AS DEPT    ,CASE WHEN weight='00' then '0'            else weight end AS ADM_W    --,'1' AS UUC --ตรวจสอบจากสิทธิที่รับบริการจึงจะถูกต้อง คือ สิทธิ UC คือ UCS หรือ WEL หรือ ว่าง    ,case when r_rp1853_instype.maininscl in ('UCS','WEL','')            then '1'            else '2'     end as UUCFROM  t_visit	INNER JOIN t_patient ON (t_patient.t_patient_id = t_visit.t_patient_id)	LEFT JOIN b_visit_ward ON (t_visit.b_visit_ward_id  = b_visit_ward.b_visit_ward_id)    LEFT JOIN t_visit_payment ON (t_visit_payment.t_visit_id = t_visit.t_visit_id and t_visit_payment.visit_payment_active = '1'        and t_visit_payment.visit_payment_priority = '0')    LEFT JOIN b_contract_plans ON t_visit_payment.b_contract_plans_id = b_contract_plans.b_contract_plans_id    LEFT JOIN r_rp1853_instype ON b_contract_plans.r_rp1853_instype_id = r_rp1853_instype.id	LEFT JOIN b_report_12files_map_clinic ON (t_visit.b_visit_clinic_id = b_report_12files_map_clinic.b_visit_clinic_id)	LEFT JOIN (select t_visit_id,  max(visit_vital_sign_weight) as weight                  from t_visit_vital_sign group by t_visit_id) as q1 on (q1.t_visit_id = t_visit.t_visit_id)where  t_visit.f_visit_type_id = '1'	AND t_visit.f_visit_status_id <> '4'--konshow : hosv39_beta_scope_010210.xls ลำดับ 218--รอเปลี่ยนเงื่อนไขของวันที่สำหรับดึงข้อมูลจาก วันที่จำหน่ายผู้ป่วยใน เป็นให้ใช้วันที่จำหน่ายทางการเงิน แทน                            AND substring(t_visit.visit_staff_doctor_discharge_date_time,1,10) >= ?                            AND substring(t_visit.visit_staff_doctor_discharge_date_time,1,10) <= ?    and t_visit.f_visit_type_id <> 'S'--AND substring(t_visit.visit_financial_discharge_time,1,10) >= '2552-10-01'--AND substring(t_visit.visit_financial_discharge_time,1,10) <= '2552-10-01'ORDER BY AN