/*
 * PanelTestReport.java
 *
 * Created on 4 ตุลาคม 2548, 10:35 น.
 */

package com.generalreport.gui.panel.report;
import com.generalreport.gui_component.TableModelGUI;
import com.generalreport.utility.Constant;
import com.generalreport.utility.Report;
import java.util.Vector;

import com.generalreport.control.HosManage;
import com.generalreport.subject.ManageGUI;
import com.generalreport.utility.GUIControl;
import com.generalreport.gui_component.DialogShowStatus;

/**
 *
 * @author  tong(Padungrat)
 */
public class PanelTestReport extends javax.swing.JPanel implements 
GUIControl,ManageGUI,Runnable
{
    
    HosManage theHosManage;
    Thread theThread;
    private String startDate;
    private String endDate;
    final private String cardName;// = "TestReport";
    Vector vcData;
    String[] headColumn;
    Vector vcDataQuery;
    TableModelGUI theTableModelGUI;
    DialogShowStatus theDialogShowStatus;
    public PanelTestReport(HosManage hosmanage) {
        theHosManage = hosmanage;
        theHosManage.theHosControl.theHosSubject.theGUISubject.registerGUIManage(this);
        cardName = ((Report)Constant.Report.get("3")).ENG_NAME;
        initComponents();
        
        theDialogShowStatus = new DialogShowStatus(theHosManage.theUS.getJFrame(),false,theHosManage);
    }

    public String getCardName() {
        return cardName;
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents()
    {
        java.awt.GridBagConstraints gridBagConstraints;

        jPanel1 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTableShowData = new javax.swing.JTable();

        setLayout(new java.awt.BorderLayout());

        jPanel1.setLayout(new java.awt.GridBagLayout());

        jTableShowData.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][]
            {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String []
            {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jScrollPane1.setViewportView(jTableShowData);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel1.add(jScrollPane1, gridBagConstraints);

        add(jPanel1, java.awt.BorderLayout.CENTER);

    }
    // </editor-fold>//GEN-END:initComponents
    
    /**ใช้ในการรับข้อมูลจาก การค้นหา และส่งค่าเข้ามา panel นี้
     *  เพื่อให้ทำการ Query และค้นหารายการตามข้อกำหนดของ panel
     *  @param startDate เป็น String เป็นวันที่เริ่มต้น อยู่ในรูปแบบ yyyy-mm-dd
     *  @param endDate เป็น String เป็นวันที่สิ้นสุด อยู่ในรูปแบบ yyyy-mm-dd
     */
    public void setQueryReport(String startDate, String endDate)
    {
        this.startDate = startDate;
        this.endDate = endDate;
        //setFileDescription();
        startQuery();
       // queryDataByDate(startDate,endDate);
    }
    
    private void queryDataByDate(String startDate, String endDate)
    {
        
        theDialogShowStatus.setVisible(false);
        theDialogShowStatus.showDialog("กรุณารอสักครู่",false);
        //vcData = theHosManage.theHosControl.theTestReportControl.queryTestReportByDate(startDate,endDate);
        headColumn = new String[] {""};
        vcDataQuery = null;
        if(vcData != null)
        {
            headColumn = (String[])vcData.get(0);
            vcDataQuery = (Vector)vcData.get(1);
        }
        
        showDataInTable(headColumn, vcDataQuery);
       // theHosManage.theHosControl.theTestReportControl.stop();
      //  theDialogShowStatus.showDialog("กรุณารอสักครู่",true);
        theDialogShowStatus.setVisible(false);
        
    }
    
    private void showDataInTable(String[] columnname,Vector vc)
    {
        String[] col = columnname;
  
       
        
        int countrows = 0;
        if(vc != null)
        {   theTableModelGUI= new TableModelGUI(col,vc.size());
            if(vc.size() > 0)
            { 
                //วนลูป ต่อ 1 แถว
                for(int i=0 ;i<vc.size(); i++)
               {    //วนลูปตของ column
                   String[] rowdata = (String[])vc.get(i);
                   
                   for(int j = 0 ; j < rowdata.length ;j++)
                   {
                        theTableModelGUI.setValueAt(rowdata[j],i,j);
                        
                   }
                   theTableModelGUI.setEditingCol(rowdata.length+1);
                   rowdata = null;
                   countrows = countrows + 1;                  
                //    tm.setValueAt(((OrderItem)this.theOrderControl.listOrderItemByItem(p.getObjectId(),this.vn)).refer_out,i,2);
                }
                
            }
            
        }
        else
        {   theTableModelGUI= new TableModelGUI(col,0);
            
        }
        this.jTableShowData.setModel(theTableModelGUI);
    }

    public void run() {
       queryDataByDate(startDate,endDate);
        
    }
    
    private void startQuery()
    {
        theThread = new Thread(this);
        theThread.start();
    }

    public void notifyStopProcess() {
        
        try
        {
          if(theThread != null)
          {
              theThread.stop();
          }
          theThread = null;
          System.out.println("In stop in HosControl");
        //  theGUISubject.setEnabled(true);
          //ยังไม่ได้ใช้
          //theManageReport12File.onShowStatus(Constant.STATUS_CANCEL_REPORT, java.awt.Color.red);
        }
        catch(Exception ex)
        {
            ex.printStackTrace();
        }
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable jTableShowData;
    // End of variables declaration//GEN-END:variables
    
}
