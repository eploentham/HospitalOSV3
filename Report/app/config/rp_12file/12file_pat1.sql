(SELECT 	b_site.b_visit_office_id as HCODE  	, t_patient.patient_hn as HN  	, substring(t_patient.patient_changwat from 1 for 2) as CHANGWAT  	, substring(t_patient.patient_amphur from 3 for 2) as AMPHUR  	, CASE WHEN (length(t_patient.patient_birthday)>=10)then to_char(to_date(to_number(substr(t_patient.patient_birthday,1,4),'9999')-543 || substr(t_patient.patient_birthday,5,6),'yyyy-mm-dd'),'yyyymmdd')                     ELSE ''   END AS DOB 	, t_patient.f_sex_id as SEX  	, t_patient.f_patient_marriage_status_id as MARRIAGE  	, CASE 		WHEN (t_patient.f_patient_occupation_id like '50%') 			THEN '01'  		WHEN (t_patient.f_patient_occupation_id ='403')  			THEN '02'  		WHEN (t_patient.f_patient_occupation_id like '8%') 			THEN '03'  		WHEN (t_patient.f_patient_occupation_id ='606')  			THEN '04'  		WHEN (t_patient.f_patient_occupation_id='202'   			OR  t_patient.f_patient_occupation_id='203'  			OR  t_patient.f_patient_occupation_id='204'  			OR  t_patient.f_patient_occupation_id='205' )  			THEN '05'  		WHEN (t_patient.f_patient_occupation_id ='105')  			THEN '06'  		WHEN (t_patient.f_patient_occupation_id='107'  			OR  t_patient.f_patient_occupation_id='108' 			OR  t_patient.f_patient_occupation_id='109' 			OR  t_patient.f_patient_occupation_id='110'  			OR  t_patient.f_patient_occupation_id='113'			OR  t_patient.f_patient_occupation_id='114' 			OR  t_patient.f_patient_occupation_id='115' 			OR  t_patient.f_patient_occupation_id='116' ) 			THEN '07'  		WHEN (t_patient.f_patient_occupation_id='130' 			OR  t_patient.f_patient_occupation_id='131'  			OR  t_patient.f_patient_occupation_id='132' 			OR  t_patient.f_patient_occupation_id='133'  			OR  t_patient.f_patient_occupation_id='134'			OR  t_patient.f_patient_occupation_id='135'  			OR  t_patient.f_patient_occupation_id='136'			OR  t_patient.f_patient_occupation_id='137' ) 			THEN '08'  		WHEN (t_patient.f_patient_occupation_id='111' 			OR  t_patient.f_patient_occupation_id='201' 			OR  t_patient.f_patient_occupation_id='206' 			OR  t_patient.f_patient_occupation_id='207'  			OR  t_patient.f_patient_occupation_id='208' )  			THEN '09'  		WHEN (t_patient.f_patient_occupation_id='301' 			OR  t_patient.f_patient_occupation_id='302' 			OR   t_patient.f_patient_occupation_id='303' ) 			THEN '10'  		WHEN (t_patient.f_patient_occupation_id='902') 			THEN '11'  		WHEN (t_patient.f_patient_occupation_id='901') 			THEN '12'  		ELSE '13'  END AS OCCUPA  	, CASE 		WHEN (t_patient.f_patient_nation_id = '99') 			THEN '01'  		WHEN (t_patient.f_patient_nation_id = '44')  			THEN '02'  		WHEN (t_patient.f_patient_nation_id = '56')  			THEN '03' 		WHEN (t_patient.f_patient_nation_id = '48')  			THEN '04'  		WHEN (t_patient.f_patient_nation_id = '57') 			THEN '05'  		WHEN (t_patient.f_patient_nation_id = '45') 			THEN '06'  		WHEN (t_patient.f_patient_nation_id = '46')  			THEN '07' 		ELSE '08'  END AS NATION  	, t_health_family.patient_pid as PERSON_ID          , (f_patient_prefix.patient_prefix_description || ' ' || t_patient.patient_firstname || ' ' ||  t_patient.patient_lastname) as NAMEPAT  FROM b_site	, t_visit  	INNER JOIN t_patient ON t_visit.t_patient_id = t_patient.t_patient_id 	INNER JOIN t_health_family ON t_health_family.t_health_family_id = t_patient.t_health_family_id     LEFT JOIN f_patient_prefix on f_patient_prefix.f_patient_prefix_id = t_patient.f_patient_prefix_idWHERE  t_visit.f_visit_status_id <> '4' 	AND substring(t_visit.visit_begin_visit_time,1,10) >= ?	AND substring(t_visit.visit_begin_visit_time,1,10) <= ?)UNION(SELECT 	b_site.b_visit_office_id as HCODE  	, t_patient.patient_hn as HN  	, substring(t_patient.patient_changwat from 1 for 2) as CHANGWAT  	, substring(t_patient.patient_amphur from 3 for 2) as AMPHUR  	, CASE WHEN (length(t_patient.patient_birthday)>=10)then to_char(to_date(to_number(substr(t_patient.patient_birthday,1,4),'9999')-543 || substr(t_patient.patient_birthday,5,6),'yyyy-mm-dd'),'yyyymmdd')                     ELSE ''   END AS DOB 	, t_patient.f_sex_id as SEX  	, t_patient.f_patient_marriage_status_id as MARRIAGE  	, CASE 		WHEN (t_patient.f_patient_occupation_id like '50%') 			THEN '01'  		WHEN (t_patient.f_patient_occupation_id ='403')  			THEN '02'  		WHEN (t_patient.f_patient_occupation_id like '8%') 			THEN '03'  		WHEN (t_patient.f_patient_occupation_id ='606')  			THEN '04'  		WHEN (t_patient.f_patient_occupation_id='202'   			OR  t_patient.f_patient_occupation_id='203'  			OR  t_patient.f_patient_occupation_id='204'  			OR  t_patient.f_patient_occupation_id='205' )  			THEN '05'  		WHEN (t_patient.f_patient_occupation_id ='105')  			THEN '06'  		WHEN (t_patient.f_patient_occupation_id='107'  			OR  t_patient.f_patient_occupation_id='108' 			OR  t_patient.f_patient_occupation_id='109' 			OR  t_patient.f_patient_occupation_id='110'  			OR  t_patient.f_patient_occupation_id='113'			OR  t_patient.f_patient_occupation_id='114' 			OR  t_patient.f_patient_occupation_id='115' 			OR  t_patient.f_patient_occupation_id='116' ) 			THEN '07'  		WHEN (t_patient.f_patient_occupation_id='130' 			OR  t_patient.f_patient_occupation_id='131'  			OR  t_patient.f_patient_occupation_id='132' 			OR  t_patient.f_patient_occupation_id='133'  			OR  t_patient.f_patient_occupation_id='134'			OR  t_patient.f_patient_occupation_id='135'  			OR  t_patient.f_patient_occupation_id='136'			OR  t_patient.f_patient_occupation_id='137' ) 			THEN '08'  		WHEN (t_patient.f_patient_occupation_id='111' 			OR  t_patient.f_patient_occupation_id='201' 			OR  t_patient.f_patient_occupation_id='206' 			OR  t_patient.f_patient_occupation_id='207'  			OR  t_patient.f_patient_occupation_id='208' )  			THEN '09'  		WHEN (t_patient.f_patient_occupation_id='301' 			OR  t_patient.f_patient_occupation_id='302' 			OR   t_patient.f_patient_occupation_id='303' ) 			THEN '10'  		WHEN (t_patient.f_patient_occupation_id='902') 			THEN '11'  		WHEN (t_patient.f_patient_occupation_id='901') 			THEN '12'  		ELSE '13'  END AS OCCUPA  	, CASE 		WHEN (t_patient.f_patient_nation_id = '99') 			THEN '01'  		WHEN (t_patient.f_patient_nation_id = '44')  			THEN '02'  		WHEN (t_patient.f_patient_nation_id = '56')  			THEN '03' 		WHEN (t_patient.f_patient_nation_id = '48')  			THEN '04'  		WHEN (t_patient.f_patient_nation_id = '57') 			THEN '05'  		WHEN (t_patient.f_patient_nation_id = '45') 			THEN '06'  		WHEN (t_patient.f_patient_nation_id = '46')  			THEN '07' 		ELSE '08'  END AS NATION  	, t_health_family.patient_pid as PERSON_ID          , (f_patient_prefix.patient_prefix_description || ' ' || t_patient.patient_firstname || ' ' ||  t_patient.patient_lastname) as NAMEPAT  FROM b_site	, t_visit  	INNER JOIN t_patient ON t_visit.t_patient_id = t_patient.t_patient_id 	INNER JOIN t_health_family ON t_health_family.t_health_family_id = t_patient.t_health_family_id     LEFT JOIN f_patient_prefix on f_patient_prefix.f_patient_prefix_id = t_patient.f_patient_prefix_idWHERE  t_visit.f_visit_status_id <> '4'     AND t_visit.f_visit_type_id = '1'       AND substring(t_visit.visit_staff_doctor_discharge_date_time,1,10) >= ?       AND substring(t_visit.visit_staff_doctor_discharge_date_time,1,10) <= ?  ORDER BY HN)