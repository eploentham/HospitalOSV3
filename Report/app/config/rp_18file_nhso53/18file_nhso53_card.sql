--CARD_53 SELECT b_site.b_visit_office_id AS PCUCODE --NOT NULL	,t_health_family.patient_pid AS CID     ,t_health_family.health_family_hn_hcis as PID --NOT NULL	,r_rp1853_instype_id AS INSTYPE  -- 	,t_patient_payment.patient_payment_card_number AS INSID 	,CASE WHEN (length(t_patient_payment.patient_payment_card_issue_date)>=10)            then to_char(to_date(to_number(substr(t_patient_payment.patient_payment_card_issue_date,1,4),'9999')-543 ||                     substr(t_patient_payment.patient_payment_card_issue_date,5,6),'yyyy-mm-dd'),'yyyymmdd')                     ELSE ''   END AS START_DATE  	,CASE WHEN (length(t_patient_payment.patient_payment_card_expire_date)>=10)            then to_char(to_date(to_number(substr(t_patient_payment.patient_payment_card_expire_date,1,4),'9999')-543 ||                 substr(t_patient_payment.patient_payment_card_expire_date,5,6),'yyyy-mm-dd'),'yyyymmdd')                     ELSE ''   END AS EXPIR_DATE  	,t_patient_payment.patient_payment_main_hospital AS MAIN 	,t_patient_payment.patient_payment_sub_hospital AS SUB     ,CASE when length(t_patient_payment.patient_payment_record_date)=10                then (to_number(substring(t_patient_payment.patient_payment_record_date,1,4),'9999') - 543)                              || substring(t_patient_payment.patient_payment_record_date,6,2)                              || substring(t_patient_payment.patient_payment_record_date,9,2)                          || '000000'                when length(t_patient_payment.patient_payment_record_date) > 10                then (to_number(substring(t_patient_payment.patient_payment_record_date,1,4),'9999') - 543)                              || substring(t_patient_payment.patient_payment_record_date,6,2)                              || substring(t_patient_payment.patient_payment_record_date,9,2)                         || substring(t_patient_payment.patient_payment_record_date,12,2)                         || substring(t_patient_payment.patient_payment_record_date,15,2)                         || substring(t_patient_payment.patient_payment_record_date,18,2)                 		ELSE ''  END AS D_UPDATE    --NOT NULLfrom t_health_village         INNER JOIN t_health_home ON  t_health_home.t_health_village_id = t_health_village.t_health_village_id        INNER JOIN t_health_family ON t_health_family.t_health_home_id = t_health_home.t_health_home_id        INNER JOIN t_patient_payment ON t_patient_payment.t_health_family_id = t_health_family.t_health_family_id        LEFT JOIN b_contract_plans on  t_patient_payment.b_contact_plans_id = b_contract_plans.b_contract_plans_id         ,b_siteWHERE  t_health_village.village_moo <> '0'          AND health_family_active = '1' union(SELECT b_site.b_visit_office_id AS PCUCODE 	, t_health_family.patient_pid AS CID 	,t_health_family.health_family_hn_hcis as PID 	,r_rp1853_instype_id AS INSTYPE  -- 	,  t_patient_payment.patient_payment_card_number AS INSID 	, CASE WHEN (length(t_patient_payment.patient_payment_card_issue_date)>=10)            then to_char(to_date(to_number(substr(t_patient_payment.patient_payment_card_issue_date,1,4),'9999')-543 ||                     substr(t_patient_payment.patient_payment_card_issue_date,5,6),'yyyy-mm-dd'),'yyyymmdd')                     ELSE ''  END AS START_DATE  	, CASE WHEN (length(t_patient_payment.patient_payment_card_expire_date)>=10)            then to_char(to_date(to_number(substr(t_patient_payment.patient_payment_card_expire_date,1,4),'9999')-543 ||                 substr(t_patient_payment.patient_payment_card_expire_date,5,6),'yyyy-mm-dd'),'yyyymmdd')                     ELSE ''  END AS EXPIR_DATE  	, t_patient_payment.patient_payment_main_hospital AS MAIN 	, t_patient_payment.patient_payment_sub_hospital AS SUB     , CASE when length(t_patient_payment.patient_payment_record_date)=10                then (to_number(substring(t_patient_payment.patient_payment_record_date,1,4),'9999') - 543)                              || substring(t_patient_payment.patient_payment_record_date,6,2)                              || substring(t_patient_payment.patient_payment_record_date,9,2)                          || '000000'                when length(t_patient_payment.patient_payment_record_date) > 10                then (to_number(substring(t_patient_payment.patient_payment_record_date,1,4),'9999') - 543)                              || substring(t_patient_payment.patient_payment_record_date,6,2)                              || substring(t_patient_payment.patient_payment_record_date,9,2)                         || substring(t_patient_payment.patient_payment_record_date,12,2)                         || substring(t_patient_payment.patient_payment_record_date,15,2)                         || substring(t_patient_payment.patient_payment_record_date,18,2)                 		ELSE ''  END AS D_UPDATE   from  t_patient_payment 	INNER JOIN t_health_family  ON t_patient_payment.t_health_family_id = t_health_family.t_health_family_id	INNER JOIN t_health_home ON t_health_family.t_health_home_id = t_health_home.t_health_home_id    INNER JOIN t_health_village ON t_health_home.t_health_village_id = t_health_village.t_health_village_id        LEFT JOIN b_contract_plans on  t_patient_payment.b_contact_plans_id = b_contract_plans.b_contract_plans_id     ,b_siteWHERE  t_health_village.village_moo = '0'              AND health_family_active = '1'--	and substring(t_patient_payment.patient_payment_record_date,1,10) >= '2552-01-01'--	and substring(t_patient_payment.patient_payment_record_date,1,10) <= '2552-01-31'     and substring(t_patient_payment.patient_payment_record_date,1,10) >= ?	and substring(t_patient_payment.patient_payment_record_date,1,10) <= ?)