SELECT  	b_site.b_visit_office_id AS PCUCODE 	, CASE 		WHEN (t_health_family.health_family_hn_hcis <> ''       			AND UPPER(t_health_family.health_family_hn_hcis) <> 'NULL'       			AND t_health_family.health_family_hn_hcis IS NOT NULL       			AND length(t_health_family.health_family_hn_hcis) = 9)         			THEN substring(t_health_family.health_family_hn_hcis,4,6)       		WHEN(t_health_family.health_family_hn_hcis <> ''       			AND UPPER(t_health_family.health_family_hn_hcis) <> 'NULL'       			AND t_health_family.health_family_hn_hcis IS NOT NULL       			AND length(t_health_family.health_family_hn_hcis) = 8)       			THEN substring(t_health_family.health_family_hn_hcis,3,6)       		WHEN(t_health_family.health_family_hn_hcis <> ''       			AND UPPER(t_health_family.health_family_hn_hcis) <> 'NULL'       			AND t_health_family.health_family_hn_hcis IS NOT NULL       			AND length(t_health_family.health_family_hn_hcis) = 7)       			THEN substring(t_health_family.health_family_hn_hcis,2,6)       		WHEN(t_health_family.health_family_hn_hcis <> ''       			AND UPPER(t_health_family.health_family_hn_hcis) <> 'NULL'       			AND t_health_family.health_family_hn_hcis IS NOT NULL       			AND length(t_health_family.health_family_hn_hcis) = 6)       			THEN t_health_family.health_family_hn_hcis       		ELSE ''   END AS PID	, CASE 		WHEN (t_visit.f_visit_type_id IS NOT NULL       			AND t_visit.f_visit_type_id <> ''       			AND t_visit.f_visit_type_id = '1'        			AND length(t_visit.visit_an) = 9)       			THEN substring(t_visit.visit_an,2,8)       		WHEN (t_visit.f_visit_type_id IS NOT NULL        			AND t_visit.f_visit_type_id <> ''       			AND t_visit.f_visit_type_id = '0'       			AND length(t_visit.visit_vn) = 9)       			THEN substring(t_visit.visit_vn,2,8)        		ELSE ''  END AS SEQ 	, CASE   		WHEN  (t_visit.visit_begin_visit_time <> ''        			AND t_visit.visit_begin_visit_time <> 'null')        			THEN  (to_number(substring(t_visit.visit_begin_visit_time,0,5),'9999')-543)        				||substring(t_visit.visit_begin_visit_time,6,2)        				|| substring(t_visit.visit_begin_visit_time,9,2)        		ELSE ''  END AS DATE_SERV 	, b_item.item_number AS DID 	, t_order.order_qty AS AMOUNT 	, ceil(t_order.order_price * t_order.order_qty) AS DRUGPRIC 	, CASE  		WHEN   (t_order.order_cost <> ''       			AND t_order.order_cost <> 'null')       			THEN    (to_number(t_order.order_cost,'9999.99') * t_order.order_qty)       		ELSE '0'   END AS DRUGCOST 		FROM   	b_site  	, t_visit  	INNER JOIN  t_order ON (t_visit.t_visit_id = t_order.t_visit_id               		AND t_visit.f_visit_type_id <> '3'               		AND t_visit.f_visit_status_id <> '4'               		AND substring(t_visit.visit_begin_visit_time,0,11) >= ?               		AND substring(t_visit.visit_begin_visit_time,0,11) <= ?               		AND (t_order.f_order_status_id = '2'                		OR t_order.f_order_status_id = '5'))       	INNER JOIN b_item  ON (t_order.b_item_id = b_item.b_item_id               		AND (t_order.f_item_group_id = '1'               		OR t_order.f_item_group_id = '4'))       	INNER JOIN t_patient ON (t_visit.t_patient_id = t_patient.t_patient_id)       	INNER JOIN t_health_family ON (t_health_family.t_health_family_id = t_patient.t_health_family_id)